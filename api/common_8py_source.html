<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>grepros: src/grepros/common.py Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">grepros
   &#160;<span id="projectnumber">0.6.0</span>
   </div>
   <div id="projectbrief">grep for ROS bag files and live topics</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('common_8py_source.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">common.py</div>  </div>
</div><!--header-->
<div class="contents">
<a href="common_8py.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno"><a class="line" href="namespacegrepros_1_1common.html">    1</a></span>&#160;<span class="comment"># -*- coding: utf-8 -*-</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160; </div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="stringliteral">Common utilities.</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="stringliteral"></span> </div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="stringliteral">------------------------------------------------------------------------------</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="stringliteral">This file is part of grepros - grep for ROS1 bag files and live topics.</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="stringliteral">Released under the BSD License.</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="stringliteral"></span> </div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="stringliteral">@author      Erki Suurjaak</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="stringliteral">@created     23.10.2021</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="stringliteral">@modified    20.10.2022</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="stringliteral">------------------------------------------------------------------------------</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="keyword">from</span> __future__ <span class="keyword">import</span> print_function</div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="keyword">import</span> datetime</div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="keyword">import</span> functools</div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="keyword">import</span> glob</div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="keyword">import</span> importlib</div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="keyword">import</span> itertools</div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="keyword">import</span> math</div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="keyword">import</span> os</div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="keyword">import</span> random</div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="keyword">import</span> re</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="keyword">import</span> shutil</div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="keyword">import</span> sys</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="keyword">import</span> threading</div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="keyword">import</span> time</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="keywordflow">try</span>: <span class="keyword">import</span> curses</div>
<div class="line"><a name="l00030"></a><span class="lineno"><a class="line" href="namespacegrepros_1_1common.html#ad049e9a9e637920340bda40f4ca0bc21">   30</a></span>&#160;<span class="keywordflow">except</span> ImportError: curses = <span class="keywordtype">None</span></div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160; </div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="keywordflow">try</span>: <span class="keyword">import</span> zstandard</div>
<div class="line"><a name="l00033"></a><span class="lineno"><a class="line" href="namespacegrepros_1_1common.html#a6dd0e8b6ec356a42afca43d19e31a18a">   33</a></span>&#160;<span class="keywordflow">except</span> ImportError: zstandard = <span class="keywordtype">None</span></div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160; </div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160; </div>
<div class="line"><a name="l00036"></a><span class="lineno"><a class="line" href="classgrepros_1_1common_1_1_match_markers.html">   36</a></span>&#160;<span class="keyword">class </span><a class="code" href="classgrepros_1_1common_1_1_match_markers.html">MatchMarkers</a>(object):</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;    <span class="stringliteral">&quot;&quot;&quot;Highlight markers for matches in message values.&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160; </div>
<div class="line"><a name="l00039"></a><span class="lineno"><a class="line" href="classgrepros_1_1common_1_1_match_markers.html#acf1f7083c16b78285bb3372325cfdce4">   39</a></span>&#160;    ID    = <span class="stringliteral">&quot;%08x&quot;</span> % random.randint(1, 1E9)  </div>
<div class="line"><a name="l00040"></a><span class="lineno"><a class="line" href="classgrepros_1_1common_1_1_match_markers.html#a9912f0c6f7fd6a83d5cd1ac02e96b393">   40</a></span>&#160;    START = <span class="stringliteral">&quot;&lt;%s&gt;&quot;</span>  % ID                     </div>
<div class="line"><a name="l00041"></a><span class="lineno"><a class="line" href="classgrepros_1_1common_1_1_match_markers.html#ae50f03b85e14192a8453f8050c2ae6c1">   41</a></span>&#160;    END   = <span class="stringliteral">&quot;&lt;/%s&gt;&quot;</span> % ID                     </div>
<div class="line"><a name="l00042"></a><span class="lineno"><a class="line" href="classgrepros_1_1common_1_1_match_markers.html#a282711bb1846129c66524e5149f5e155">   42</a></span>&#160;    EMPTY = START + END                      </div>
<div class="line"><a name="l00043"></a><span class="lineno"><a class="line" href="classgrepros_1_1common_1_1_match_markers.html#af32f75a12a0ba1a055cff93450d9140d">   43</a></span>&#160;    EMPTY_REPL = <span class="stringliteral">&quot;%s&#39;&#39;%s&quot;</span> % (START, END)     </div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160; </div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160; </div>
<div class="line"><a name="l00046"></a><span class="lineno"><a class="line" href="classgrepros_1_1common_1_1_console_printer.html">   46</a></span>&#160;<span class="keyword">class </span><a class="code" href="classgrepros_1_1common_1_1_console_printer.html">ConsolePrinter</a>(object):</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;    <span class="stringliteral">&quot;&quot;&quot;Prints to console, supports color output.&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160; </div>
<div class="line"><a name="l00049"></a><span class="lineno"><a class="line" href="classgrepros_1_1common_1_1_console_printer.html#adc19d62887c9c40b9b1bb8b8d93d5ed0">   49</a></span>&#160;    STYLE_RESET     = <span class="stringliteral">&quot;\x1b(B\x1b[m&quot;</span>            </div>
<div class="line"><a name="l00050"></a><span class="lineno"><a class="line" href="classgrepros_1_1common_1_1_console_printer.html#a2b7d83e6f45ffc83b6bf2701604f17a3">   50</a></span>&#160;    STYLE_HIGHLIGHT = <span class="stringliteral">&quot;\x1b[31m&quot;</span>                </div>
<div class="line"><a name="l00051"></a><span class="lineno"><a class="line" href="classgrepros_1_1common_1_1_console_printer.html#a6c15f9df497ebfefadc582fd19f64a85">   51</a></span>&#160;    STYLE_LOWLIGHT  = <span class="stringliteral">&quot;\x1b[38;2;105;105;105m&quot;</span>  </div>
<div class="line"><a name="l00052"></a><span class="lineno"><a class="line" href="classgrepros_1_1common_1_1_console_printer.html#ab9b0f7c1dabcbf18ff4f6425453a469c">   52</a></span>&#160;    STYLE_SPECIAL   = <span class="stringliteral">&quot;\x1b[35m&quot;</span>                </div>
<div class="line"><a name="l00053"></a><span class="lineno"><a class="line" href="classgrepros_1_1common_1_1_console_printer.html#a8013306fb7624baaa4069120668cd6b7">   53</a></span>&#160;    STYLE_SPECIAL2  = <span class="stringliteral">&quot;\x1b[36m&quot;</span>                </div>
<div class="line"><a name="l00054"></a><span class="lineno"><a class="line" href="classgrepros_1_1common_1_1_console_printer.html#af2fc71ba34022b648d81ca257899058a">   54</a></span>&#160;    STYLE_WARN      = <span class="stringliteral">&quot;\x1b[33m&quot;</span>                </div>
<div class="line"><a name="l00055"></a><span class="lineno"><a class="line" href="classgrepros_1_1common_1_1_console_printer.html#a6e3d360b6df97f2cfc3d52a67d92d44d">   55</a></span>&#160;    STYLE_ERROR     = <span class="stringliteral">&quot;\x1b[31m\x1b[2m&quot;</span>         </div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160; </div>
<div class="line"><a name="l00057"></a><span class="lineno"><a class="line" href="classgrepros_1_1common_1_1_console_printer.html#a9bd93596caa75c86e7fa423f02ab1a6c">   57</a></span>&#160;    DEBUG_START, DEBUG_END = STYLE_LOWLIGHT, STYLE_RESET  </div>
<div class="line"><a name="l00058"></a><span class="lineno"><a class="line" href="classgrepros_1_1common_1_1_console_printer.html#a21ead9564c18f7a6afd439a5660e0526">   58</a></span>&#160;    WARN_START,  WARN_END =  STYLE_WARN,     STYLE_RESET  </div>
<div class="line"><a name="l00059"></a><span class="lineno"><a class="line" href="classgrepros_1_1common_1_1_console_printer.html#adadd930a96f7396162da394dd8c0afe5">   59</a></span>&#160;    ERROR_START, ERROR_END = STYLE_ERROR,    STYLE_RESET  </div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160; </div>
<div class="line"><a name="l00061"></a><span class="lineno"><a class="line" href="classgrepros_1_1common_1_1_console_printer.html#af90824509586333cf45ce757d2711ce3">   61</a></span>&#160;    COLOR = <span class="keywordtype">None</span>       </div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160; </div>
<div class="line"><a name="l00063"></a><span class="lineno"><a class="line" href="classgrepros_1_1common_1_1_console_printer.html#a59c3bba4b17cd5e19f149ea175fa6989">   63</a></span>&#160;    WIDTH = 80         </div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160; </div>
<div class="line"><a name="l00065"></a><span class="lineno"><a class="line" href="classgrepros_1_1common_1_1_console_printer.html#aacebe601cd2ff73384e4c4cac54de357">   65</a></span>&#160;    PRINTS = {}        </div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160; </div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;    _LINEOPEN = <span class="keyword">False</span>  </div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160; </div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;    _UNIQUES = set()   </div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160; </div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;    @classmethod</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    <span class="keyword">def </span><a class="code" href="classgrepros_1_1common_1_1_console_printer.html#ac6698ed375a764f7491334e3e98fa234">configure</a>(cls, color):</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;<span class="stringliteral">        Initializes terminal for color output, or disables color output if unsupported.</span></div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;<span class="stringliteral"></span> </div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;<span class="stringliteral">        @param   color  True / False / None for auto-detect from TTY support</span></div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;<span class="stringliteral">        &quot;&quot;&quot;</span></div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;        <span class="keywordflow">try</span>: cls.<a class="code" href="classgrepros_1_1common_1_1_console_printer.html#a59c3bba4b17cd5e19f149ea175fa6989">WIDTH</a> = shutil.get_terminal_size().columns  <span class="comment"># Py3</span></div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;        <span class="keywordflow">except</span> Exception: <span class="keywordflow">pass</span>  <span class="comment"># Py2</span></div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;        cls.<a class="code" href="classgrepros_1_1common_1_1_console_printer.html#af90824509586333cf45ce757d2711ce3">COLOR</a> = (color <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keyword">False</span>)</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;        <span class="keywordflow">try</span>:</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;            curses.setupterm()</div>
<div class="line"><a name="l00083"></a><span class="lineno"><a class="line" href="classgrepros_1_1common_1_1_console_printer.html#ac6698ed375a764f7491334e3e98fa234">   83</a></span>&#160;            <span class="keywordflow">if</span> cls.<a class="code" href="classgrepros_1_1common_1_1_console_printer.html#af90824509586333cf45ce757d2711ce3">COLOR</a> <span class="keywordflow">and</span> <span class="keywordflow">not</span> sys.stdout.isatty():</div>
<div class="line"><a name="l00084"></a><span class="lineno"><a class="line" href="classgrepros_1_1common_1_1_console_printer.html#a76a791c70caa47f85044264f1468131a">   84</a></span>&#160;                <span class="keywordflow">raise</span> <a class="code" href="class_exception.html">Exception</a>()</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;        <span class="keywordflow">except</span> Exception:</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;            cls.<a class="code" href="classgrepros_1_1common_1_1_console_printer.html#af90824509586333cf45ce757d2711ce3">COLOR</a> = bool(color)</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;        <span class="keywordflow">try</span>:</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;            <span class="keywordflow">if</span> sys.stdout.isatty() <span class="keywordflow">or</span> cls.<a class="code" href="classgrepros_1_1common_1_1_console_printer.html#af90824509586333cf45ce757d2711ce3">COLOR</a>:</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;                cls.<a class="code" href="classgrepros_1_1common_1_1_console_printer.html#a59c3bba4b17cd5e19f149ea175fa6989">WIDTH</a> = curses.initscr().getmaxyx()[1]</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;            curses.endwin()</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;        <span class="keywordflow">except</span> Exception: <span class="keywordflow">pass</span></div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160; </div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;        <span class="keywordflow">if</span> cls.<a class="code" href="classgrepros_1_1common_1_1_console_printer.html#af90824509586333cf45ce757d2711ce3">COLOR</a>:</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;            cls.<a class="code" href="classgrepros_1_1common_1_1_console_printer.html#a9bd93596caa75c86e7fa423f02ab1a6c">DEBUG_START</a>, cls.<a class="code" href="classgrepros_1_1common_1_1_console_printer.html#a70034fa7a4a0f7912242988a590a85cb">DEBUG_END</a> = cls.<a class="code" href="classgrepros_1_1common_1_1_console_printer.html#a6c15f9df497ebfefadc582fd19f64a85">STYLE_LOWLIGHT</a>, cls.<a class="code" href="classgrepros_1_1common_1_1_console_printer.html#adc19d62887c9c40b9b1bb8b8d93d5ed0">STYLE_RESET</a></div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;            cls.<a class="code" href="classgrepros_1_1common_1_1_console_printer.html#a21ead9564c18f7a6afd439a5660e0526">WARN_START</a>,  cls.<a class="code" href="classgrepros_1_1common_1_1_console_printer.html#a020554d0db454919368e7f18bee125f8">WARN_END</a>  = cls.<a class="code" href="classgrepros_1_1common_1_1_console_printer.html#af2fc71ba34022b648d81ca257899058a">STYLE_WARN</a>,     cls.<a class="code" href="classgrepros_1_1common_1_1_console_printer.html#adc19d62887c9c40b9b1bb8b8d93d5ed0">STYLE_RESET</a></div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;            cls.<a class="code" href="classgrepros_1_1common_1_1_console_printer.html#adadd930a96f7396162da394dd8c0afe5">ERROR_START</a>, cls.<a class="code" href="classgrepros_1_1common_1_1_console_printer.html#aeffdcb40de1409c8869d68032c86b904">ERROR_END</a> = cls.<a class="code" href="classgrepros_1_1common_1_1_console_printer.html#a6e3d360b6df97f2cfc3d52a67d92d44d">STYLE_ERROR</a>,    cls.<a class="code" href="classgrepros_1_1common_1_1_console_printer.html#adc19d62887c9c40b9b1bb8b8d93d5ed0">STYLE_RESET</a></div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;        <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;            cls.<a class="code" href="classgrepros_1_1common_1_1_console_printer.html#a9bd93596caa75c86e7fa423f02ab1a6c">DEBUG_START</a>, cls.<a class="code" href="classgrepros_1_1common_1_1_console_printer.html#a70034fa7a4a0f7912242988a590a85cb">DEBUG_END</a> = <span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;&quot;</span></div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;            cls.<a class="code" href="classgrepros_1_1common_1_1_console_printer.html#a21ead9564c18f7a6afd439a5660e0526">WARN_START</a>,  cls.<a class="code" href="classgrepros_1_1common_1_1_console_printer.html#a020554d0db454919368e7f18bee125f8">WARN_END</a>  = <span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;&quot;</span></div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;            cls.<a class="code" href="classgrepros_1_1common_1_1_console_printer.html#adadd930a96f7396162da394dd8c0afe5">ERROR_START</a>, cls.<a class="code" href="classgrepros_1_1common_1_1_console_printer.html#aeffdcb40de1409c8869d68032c86b904">ERROR_END</a> = <span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;&quot;</span></div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160; </div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160; </div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;    @classmethod</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;    <span class="keyword">def </span><a class="code" href="classgrepros_1_1common_1_1_console_printer.html#ada74a697af3acfc006ca23fedee36428">print</a>(cls, text=&quot;&quot;, *args, **kwargs):</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;<span class="stringliteral">        Prints text, formatted with args and kwargs.</span></div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;<span class="stringliteral"></span> </div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;<span class="stringliteral">        @param   __file   file object to print to if not sys.stdout</span></div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;<span class="stringliteral">        @param   __end    line end to use if not linefeed &quot;\n&quot;</span></div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;<span class="stringliteral">        @param   __once   whether text should be printed only once</span></div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;<span class="stringliteral">                          and discarded on any further calls (applies to unformatted text)</span></div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;<span class="stringliteral">        &quot;&quot;&quot;</span></div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;        text, fmted = str(text), <span class="keyword">False</span></div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;        <span class="keywordflow">if</span> kwargs.pop(<span class="stringliteral">&quot;__once&quot;</span>, <span class="keyword">False</span>):</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;            <span class="keywordflow">if</span> text <span class="keywordflow">in</span> cls.<a class="code" href="classgrepros_1_1common_1_1_console_printer.html#a3936bf6da60f41002f1c863aeb598805">_UNIQUES</a>: <span class="keywordflow">return</span></div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;            cls.<a class="code" href="classgrepros_1_1common_1_1_console_printer.html#a3936bf6da60f41002f1c863aeb598805">_UNIQUES</a>.add(text)</div>
<div class="line"><a name="l00117"></a><span class="lineno"><a class="line" href="classgrepros_1_1common_1_1_console_printer.html#ada74a697af3acfc006ca23fedee36428">  117</a></span>&#160;        fileobj, end = kwargs.pop(<span class="stringliteral">&quot;__file&quot;</span>, sys.stdout), kwargs.pop(<span class="stringliteral">&quot;__end&quot;</span>, <span class="stringliteral">&quot;\n&quot;</span>)</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;        pref, suff = kwargs.pop(<span class="stringliteral">&quot;__prefix&quot;</span>, <span class="stringliteral">&quot;&quot;</span>), kwargs.pop(<span class="stringliteral">&quot;__suffix&quot;</span>, <span class="stringliteral">&quot;&quot;</span>)</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;        <span class="keywordflow">try</span>: text, fmted = (text % args <span class="keywordflow">if</span> args <span class="keywordflow">else</span> text), bool(args)</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;        <span class="keywordflow">except</span> Exception: <span class="keywordflow">pass</span></div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;        <span class="keywordflow">try</span>: text, fmted = (text % kwargs <span class="keywordflow">if</span> kwargs <span class="keywordflow">else</span> text), fmted <span class="keywordflow">or</span> bool(kwargs)</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;        <span class="keywordflow">except</span> Exception: <span class="keywordflow">pass</span></div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;        <span class="keywordflow">try</span>: text = text.format(*args, **kwargs) <span class="keywordflow">if</span> <span class="keywordflow">not</span> fmted <span class="keywordflow">and</span> (args <span class="keywordflow">or</span> kwargs) <span class="keywordflow">else</span> text</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;        <span class="keywordflow">except</span> Exception: <span class="keywordflow">pass</span></div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;        <span class="keywordflow">if</span> cls.<a class="code" href="classgrepros_1_1common_1_1_console_printer.html#a58615d20b29afc34a4bd73de20c61854">_LINEOPEN</a> <span class="keywordflow">and</span> <span class="stringliteral">&quot;\n&quot;</span> <span class="keywordflow">in</span> end: pref = <span class="stringliteral">&quot;\n&quot;</span> + pref  <span class="comment"># Add linefeed to end open line</span></div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160; </div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;        cls.<a class="code" href="classgrepros_1_1common_1_1_console_printer.html#aacebe601cd2ff73384e4c4cac54de357">PRINTS</a>[fileobj] = cls.<a class="code" href="classgrepros_1_1common_1_1_console_printer.html#aacebe601cd2ff73384e4c4cac54de357">PRINTS</a>.get(fileobj, 0) + 1</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;        cls.<a class="code" href="classgrepros_1_1common_1_1_console_printer.html#a58615d20b29afc34a4bd73de20c61854">_LINEOPEN</a> = <span class="stringliteral">&quot;\n&quot;</span> <span class="keywordflow">not</span> <span class="keywordflow">in</span> end</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;        <a class="code" href="classgrepros_1_1common_1_1_console_printer.html#ada74a697af3acfc006ca23fedee36428">print</a>(pref + text + suff, end=end, file=fileobj)</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;        <span class="keywordflow">not</span> fileobj.isatty() <span class="keywordflow">and</span> fileobj.flush()</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160; </div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160; </div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;    @classmethod</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;    <span class="keyword">def </span><a class="code" href="classgrepros_1_1common_1_1_console_printer.html#ae981ec329c0c9ac737283da55c865724">error</a>(cls, text=&quot;&quot;, *args, **kwargs):</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;Prints error to stderr, formatted with args and kwargs, in error colors if supported.&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;        KWS = dict(__file=sys.stderr, __prefix=cls.<a class="code" href="classgrepros_1_1common_1_1_console_printer.html#adadd930a96f7396162da394dd8c0afe5">ERROR_START</a>, __suffix=cls.<a class="code" href="classgrepros_1_1common_1_1_console_printer.html#aeffdcb40de1409c8869d68032c86b904">ERROR_END</a>)</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;        cls.<a class="code" href="classgrepros_1_1common_1_1_console_printer.html#ada74a697af3acfc006ca23fedee36428">print</a>(text, *args, **dict(kwargs, **KWS))</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160; </div>
<div class="line"><a name="l00139"></a><span class="lineno"><a class="line" href="classgrepros_1_1common_1_1_console_printer.html#ae981ec329c0c9ac737283da55c865724">  139</a></span>&#160; </div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;    @classmethod</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;    <span class="keyword">def </span><a class="code" href="classgrepros_1_1common_1_1_console_printer.html#a31f4aa0ec2886058132efc52572bace5">warn</a>(cls, text=&quot;&quot;, *args, **kwargs):</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;<span class="stringliteral">        Prints warning to stderr.</span></div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;<span class="stringliteral"></span> </div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;<span class="stringliteral">        Formatted with args and kwargs, in warning colors if supported.</span></div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;<span class="stringliteral">        &quot;&quot;&quot;</span></div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;        KWS = dict(__file=sys.stderr, __prefix=cls.<a class="code" href="classgrepros_1_1common_1_1_console_printer.html#a21ead9564c18f7a6afd439a5660e0526">WARN_START</a>, __suffix=cls.<a class="code" href="classgrepros_1_1common_1_1_console_printer.html#a020554d0db454919368e7f18bee125f8">WARN_END</a>)</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;        cls.<a class="code" href="classgrepros_1_1common_1_1_console_printer.html#ada74a697af3acfc006ca23fedee36428">print</a>(text, *args, **dict(kwargs, **KWS))</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160; </div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160; </div>
<div class="line"><a name="l00151"></a><span class="lineno"><a class="line" href="classgrepros_1_1common_1_1_console_printer.html#a31f4aa0ec2886058132efc52572bace5">  151</a></span>&#160;    @classmethod</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    <span class="keyword">def </span><a class="code" href="classgrepros_1_1common_1_1_console_printer.html#a471aca6fad4c414e644c86e5621627a5">debug</a>(cls, text=&quot;&quot;, *args, **kwargs):</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;<span class="stringliteral">        Prints debug text to stderr.</span></div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;<span class="stringliteral"></span> </div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;<span class="stringliteral">        Formatted with args and kwargs, in lowlight colors if supported.</span></div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;<span class="stringliteral">        &quot;&quot;&quot;</span></div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;        KWS = dict(__file=sys.stderr, __prefix=cls.<a class="code" href="classgrepros_1_1common_1_1_console_printer.html#a9bd93596caa75c86e7fa423f02ab1a6c">DEBUG_START</a>, __suffix=cls.<a class="code" href="classgrepros_1_1common_1_1_console_printer.html#a70034fa7a4a0f7912242988a590a85cb">DEBUG_END</a>)</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;        cls.<a class="code" href="classgrepros_1_1common_1_1_console_printer.html#ada74a697af3acfc006ca23fedee36428">print</a>(text, *args, **dict(kwargs, **KWS))</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160; </div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160; </div>
<div class="line"><a name="l00162"></a><span class="lineno"><a class="line" href="classgrepros_1_1common_1_1_console_printer.html#a471aca6fad4c414e644c86e5621627a5">  162</a></span>&#160;    @classmethod</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;    <span class="keyword">def </span><a class="code" href="classgrepros_1_1common_1_1_console_printer.html#ae2ef5cf47c5bfd243e2e050721e25053">flush</a>(cls):</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;Ends current open line, if any.&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;        <span class="keywordflow">if</span> cls.<a class="code" href="classgrepros_1_1common_1_1_console_printer.html#a58615d20b29afc34a4bd73de20c61854">_LINEOPEN</a>: <a class="code" href="classgrepros_1_1common_1_1_console_printer.html#ada74a697af3acfc006ca23fedee36428">print</a>()</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;        cls.<a class="code" href="classgrepros_1_1common_1_1_console_printer.html#a58615d20b29afc34a4bd73de20c61854">_LINEOPEN</a> = <span class="keyword">False</span></div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160; </div>
<div class="line"><a name="l00168"></a><span class="lineno"><a class="line" href="classgrepros_1_1common_1_1_console_printer.html#ae2ef5cf47c5bfd243e2e050721e25053">  168</a></span>&#160; </div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;<span class="keyword">class </span><a class="code" href="classgrepros_1_1common_1_1_decompressor.html">Decompressor</a>(object):</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;    <span class="stringliteral">&quot;&quot;&quot;Decompresses zstandard archives.&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160; </div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;    </div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;    EXTENSIONS = (<span class="stringliteral">&quot;.zst&quot;</span>, <span class="stringliteral">&quot;.zstd&quot;</span>)</div>
<div class="line"><a name="l00174"></a><span class="lineno"><a class="line" href="classgrepros_1_1common_1_1_decompressor.html">  174</a></span>&#160; </div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;    </div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;    ZSTD_MAGIC = b<span class="stringliteral">&quot;\x28\xb5\x2f\xfd&quot;</span></div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160; </div>
<div class="line"><a name="l00178"></a><span class="lineno"><a class="line" href="classgrepros_1_1common_1_1_decompressor.html#ad2788c37d3aed499aa410f6d17e2f4b9">  178</a></span>&#160; </div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;    @classmethod</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;    <span class="keyword">def </span><a class="code" href="classgrepros_1_1common_1_1_decompressor.html#adb5bece19722ba188d4b205a7de1cf24">decompress</a>(cls, path, progress=False):</div>
<div class="line"><a name="l00181"></a><span class="lineno"><a class="line" href="classgrepros_1_1common_1_1_decompressor.html#a69348d5743a47cc864a5ea5a93349d63">  181</a></span>&#160;        <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;<span class="stringliteral">        Decompresses file to same directory, showing optional progress bar.</span></div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;<span class="stringliteral"></span> </div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;<span class="stringliteral">        @return  uncompressed file path</span></div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;<span class="stringliteral">        &quot;&quot;&quot;</span></div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;        cls.<a class="code" href="classgrepros_1_1common_1_1_decompressor.html#a389efe91f5934c31d830e1352b5f9c6d">validate</a>()</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;        path2, bar, size, processed = os.path.splitext(path)[0], <span class="keywordtype">None</span>, os.path.getsize(path), 0</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;        fmt = <span class="keyword">lambda</span> s: <a class="code" href="namespacegrepros_1_1common.html#a19c80f3a78c0a68f7c04def7511a1a0c">format_bytes</a>(s, strip=<span class="keyword">False</span>)</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;        <span class="keywordflow">if</span> progress:</div>
<div class="line"><a name="l00190"></a><span class="lineno"><a class="line" href="classgrepros_1_1common_1_1_decompressor.html#adb5bece19722ba188d4b205a7de1cf24">  190</a></span>&#160;            tpl = <span class="stringliteral">&quot; Decompressing %s (%s): {afterword}&quot;</span> % (os.path.basename(path), fmt(size))</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;            bar = <a class="code" href="classgrepros_1_1common_1_1_progress_bar.html">ProgressBar</a>(pulse=<span class="keyword">True</span>, aftertemplate=tpl)</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160; </div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;        ConsolePrinter.warn(<span class="stringliteral">&quot;Compressed file %s (%s), decompressing to %s.&quot;</span>, path, fmt(size), path2)</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;        bar <span class="keywordflow">and</span> bar.update(0).start()  <span class="comment"># Start progress pulse</span></div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;        <span class="keywordflow">try</span>:</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;            <span class="keyword">with</span> open(path, <span class="stringliteral">&quot;rb&quot;</span>) <span class="keyword">as</span> f, open(path2, <span class="stringliteral">&quot;wb&quot;</span>) <span class="keyword">as</span> g:</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;                reader = zstandard.ZstdDecompressor().stream_reader(f)</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;                <span class="keywordflow">while</span> <span class="keyword">True</span>:</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;                    chunk = reader.read(1048576)</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;                    <span class="keywordflow">if</span> <span class="keywordflow">not</span> chunk: <span class="keywordflow">break</span>  <span class="comment"># while</span></div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160; </div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;                    g.write(chunk)</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;                    processed += len(chunk)</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;                    bar <span class="keywordflow">and</span> (setattr(bar, <span class="stringliteral">&quot;afterword&quot;</span>, fmt(processed)), bar.update(processed))</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;                reader.close()</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;        <span class="keywordflow">except</span> Exception:</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;            os.remove(path2)</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;            <span class="keywordflow">raise</span></div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;        <span class="keywordflow">finally</span>: bar <span class="keywordflow">and</span> (setattr(bar, <span class="stringliteral">&quot;pulse&quot;</span>, <span class="keyword">False</span>), bar.update(processed).stop())</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;        <span class="keywordflow">return</span> path2</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160; </div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160; </div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;    @classmethod</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;    <span class="keyword">def </span><a class="code" href="classgrepros_1_1common_1_1_decompressor.html#a076bb39cd43c5e24718d58cfef776520">is_compressed</a>(cls, path):</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;Returns whether file is a recognized archive.&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;        result = os.path.isfile(path)</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;        <span class="keywordflow">if</span> result:</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;            result = any(path.lower().endswith(x) <span class="keywordflow">for</span> x <span class="keywordflow">in</span> cls.<a class="code" href="classgrepros_1_1common_1_1_decompressor.html#ad2788c37d3aed499aa410f6d17e2f4b9">EXTENSIONS</a>)</div>
<div class="line"><a name="l00219"></a><span class="lineno"><a class="line" href="classgrepros_1_1common_1_1_decompressor.html#a076bb39cd43c5e24718d58cfef776520">  219</a></span>&#160;        <span class="keywordflow">if</span> result:</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;            <span class="keyword">with</span> open(path, <span class="stringliteral">&quot;rb&quot;</span>) <span class="keyword">as</span> f:</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;                result = (f.read(len(cls.<a class="code" href="classgrepros_1_1common_1_1_decompressor.html#a69348d5743a47cc864a5ea5a93349d63">ZSTD_MAGIC</a>)) == cls.<a class="code" href="classgrepros_1_1common_1_1_decompressor.html#a69348d5743a47cc864a5ea5a93349d63">ZSTD_MAGIC</a>)</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;        <span class="keywordflow">return</span> result</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160; </div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160; </div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;    @classmethod</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;    <span class="keyword">def </span><a class="code" href="classgrepros_1_1common_1_1_decompressor.html#ab10deb1b0b3424fa47b1dcb39809e9b6">make_decompressed_name</a>(cls, path):</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;Returns the path without archive extension, if any.&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;        <span class="keywordflow">return</span> os.path.splitext(path)[0] <span class="keywordflow">if</span> cls.<a class="code" href="classgrepros_1_1common_1_1_decompressor.html#a076bb39cd43c5e24718d58cfef776520">is_compressed</a>(path) <span class="keywordflow">else</span> path</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160; </div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160; </div>
<div class="line"><a name="l00231"></a><span class="lineno"><a class="line" href="classgrepros_1_1common_1_1_decompressor.html#ab10deb1b0b3424fa47b1dcb39809e9b6">  231</a></span>&#160;    @classmethod</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;    <span class="keyword">def </span><a class="code" href="classgrepros_1_1common_1_1_decompressor.html#a389efe91f5934c31d830e1352b5f9c6d">validate</a>(cls):</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;Raises error if decompression library not available.&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;        <span class="keywordflow">if</span> <span class="keywordflow">not</span> zstandard: <span class="keywordflow">raise</span> <a class="code" href="class_exception.html">Exception</a>(<span class="stringliteral">&quot;zstandard not installed, cannot decompress&quot;</span>)</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160; </div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160; </div>
<div class="line"><a name="l00237"></a><span class="lineno"><a class="line" href="classgrepros_1_1common_1_1_decompressor.html#a389efe91f5934c31d830e1352b5f9c6d">  237</a></span>&#160; </div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;<span class="keyword">class </span><a class="code" href="classgrepros_1_1common_1_1_progress_bar.html">ProgressBar</a>(threading.Thread):</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;    <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;<span class="stringliteral">    A simple ASCII progress bar with a ticker thread</span></div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;<span class="stringliteral"></span> </div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;<span class="stringliteral">    Drawn like</span></div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;<span class="stringliteral">    &#39;[---------/   36%            ] Progressing text..&#39;.</span></div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;<span class="stringliteral">    or for pulse mode</span></div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;<span class="stringliteral">    &#39;[    ----                    ] Progressing text..&#39;.</span></div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;<span class="stringliteral">    &quot;&quot;&quot;</span></div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160; </div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;    <span class="keyword">def </span>__init__(self, max=100, value=0, min=0, width=30, forechar=&quot;-&quot;,</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;                 backchar=&quot; &quot;, foreword=&quot;&quot;, afterword=&quot;&quot;, interval=1,</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;                 pulse=False, aftertemplate=&quot; {afterword}&quot;):</div>
<div class="line"><a name="l00251"></a><span class="lineno"><a class="line" href="classgrepros_1_1common_1_1_progress_bar.html">  251</a></span>&#160;        <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;<span class="stringliteral">        Creates a new progress bar, without drawing it yet.</span></div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;<span class="stringliteral"></span> </div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;<span class="stringliteral">        @param   max            progress bar maximum value, 100%</span></div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;<span class="stringliteral">        @param   value          progress bar initial value</span></div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;<span class="stringliteral">        @param   min            progress bar minimum value, for 0%</span></div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;<span class="stringliteral">        @param   width          progress bar width (in characters)</span></div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;<span class="stringliteral">        @param   forechar       character used for filling the progress bar</span></div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;<span class="stringliteral">        @param   backchar       character used for filling the background</span></div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;<span class="stringliteral">        @param   foreword       text in front of progress bar</span></div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;<span class="stringliteral">        @param   afterword      text after progress bar</span></div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;<span class="stringliteral">        @param   interval       ticker thread interval, in seconds</span></div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;<span class="stringliteral">        @param   pulse          ignore value-min-max, use constant pulse instead</span></div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;<span class="stringliteral">        @param   counts         print value and nax afterword</span></div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;<span class="stringliteral">        @param   aftertemplate  afterword format() template, populated with vars(self)</span></div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;<span class="stringliteral">        &quot;&quot;&quot;</span></div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;        threading.Thread.__init__(self)</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;        <span class="keywordflow">for</span> k, v <span class="keywordflow">in</span> locals().items(): setattr(self, k, v) <span class="keywordflow">if</span> <span class="stringliteral">&quot;self&quot;</span> != k <span class="keywordflow">else</span> 0</div>
<div class="line"><a name="l00269"></a><span class="lineno"><a class="line" href="classgrepros_1_1common_1_1_progress_bar.html#a12201259b1d8ac76659c96c664633cc0">  269</a></span>&#160;        afterword = aftertemplate.format(**vars(self))</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;        self.<a class="code" href="classgrepros_1_1common_1_1_progress_bar.html#a56336262068f0a007b1dec71901be1ff">daemon</a>    = <span class="keyword">True</span>   <span class="comment"># Daemon threads do not keep application running</span></div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;        self.<a class="code" href="classgrepros_1_1common_1_1_progress_bar.html#a174e692bc1b62677e7b4d611ed06b109">percent</a>   = <span class="keywordtype">None</span>   <span class="comment"># Current progress ratio in per cent</span></div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;        self.<a class="code" href="classgrepros_1_1common_1_1_progress_bar.html#afcc7a4b78ecd8fa7e713f8cfa0f51017">value</a>     = <span class="keywordtype">None</span>   <span class="comment"># Current progress bar value</span></div>
<div class="line"><a name="l00273"></a><span class="lineno"><a class="line" href="classgrepros_1_1common_1_1_progress_bar.html#a56336262068f0a007b1dec71901be1ff">  273</a></span>&#160;        self.<a class="code" href="classgrepros_1_1common_1_1_progress_bar.html#afd7d49e17b69bd6bf3d7a649856c1067">pause</a>     = <span class="keyword">False</span>  <span class="comment"># Whether drawing is currently paused</span></div>
<div class="line"><a name="l00274"></a><span class="lineno"><a class="line" href="classgrepros_1_1common_1_1_progress_bar.html#a174e692bc1b62677e7b4d611ed06b109">  274</a></span>&#160;        self.<a class="code" href="classgrepros_1_1common_1_1_progress_bar.html#a9c17a624c873883e9fccc9debdb1c10f">pulse_pos</a> = 0      <span class="comment"># Current pulse position</span></div>
<div class="line"><a name="l00275"></a><span class="lineno"><a class="line" href="classgrepros_1_1common_1_1_progress_bar.html#afcc7a4b78ecd8fa7e713f8cfa0f51017">  275</a></span>&#160;        self.<a class="code" href="classgrepros_1_1common_1_1_progress_bar.html#a5426824942db4253f87a1009fd5d2d4f">bar</a> = <span class="stringliteral">&quot;%s[%s%s]%s&quot;</span> % (foreword,</div>
<div class="line"><a name="l00276"></a><span class="lineno"><a class="line" href="classgrepros_1_1common_1_1_progress_bar.html#afd7d49e17b69bd6bf3d7a649856c1067">  276</a></span>&#160;                                   backchar <span class="keywordflow">if</span> pulse <span class="keywordflow">else</span> forechar,</div>
<div class="line"><a name="l00277"></a><span class="lineno"><a class="line" href="classgrepros_1_1common_1_1_progress_bar.html#a9c17a624c873883e9fccc9debdb1c10f">  277</a></span>&#160;                                   backchar * (width - 3),</div>
<div class="line"><a name="l00278"></a><span class="lineno"><a class="line" href="classgrepros_1_1common_1_1_progress_bar.html#a5426824942db4253f87a1009fd5d2d4f">  278</a></span>&#160;                                   afterword)</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;        self.<a class="code" href="classgrepros_1_1common_1_1_progress_bar.html#a1702ac8242f004352282d0e43bcedaea">printbar</a> = self.<a class="code" href="classgrepros_1_1common_1_1_progress_bar.html#a5426824942db4253f87a1009fd5d2d4f">bar</a>   <span class="comment"># Printable text, with padding to clear previous</span></div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;        self.<a class="code" href="classgrepros_1_1common_1_1_progress_bar.html#a4299f0f984e2afbd4fcd4db6c744fdb5">progresschar</a> = itertools.cycle(<span class="stringliteral">&quot;-\\|/&quot;</span>)</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;        self.<a class="code" href="classgrepros_1_1common_1_1_progress_bar.html#ae2dc0f1c541d7886d07e3e3d7f11b643">is_running</a> = <span class="keyword">False</span></div>
<div class="line"><a name="l00282"></a><span class="lineno"><a class="line" href="classgrepros_1_1common_1_1_progress_bar.html#a1702ac8242f004352282d0e43bcedaea">  282</a></span>&#160; </div>
<div class="line"><a name="l00283"></a><span class="lineno"><a class="line" href="classgrepros_1_1common_1_1_progress_bar.html#a4299f0f984e2afbd4fcd4db6c744fdb5">  283</a></span>&#160; </div>
<div class="line"><a name="l00284"></a><span class="lineno"><a class="line" href="classgrepros_1_1common_1_1_progress_bar.html#ae2dc0f1c541d7886d07e3e3d7f11b643">  284</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classgrepros_1_1common_1_1_progress_bar.html#acd1b00228d32592329c086639774536e">update</a>(self, value=None, draw=True, flush=False):</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;Updates the progress bar value, and refreshes by default; returns self.&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;        <span class="keywordflow">if</span> value <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>: self.<a class="code" href="classgrepros_1_1common_1_1_progress_bar.html#afcc7a4b78ecd8fa7e713f8cfa0f51017">value</a> = min(self.max, max(self.min, value))</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;        afterword = self.aftertemplate.format(**vars(self))</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;        w_full = self.width - 2</div>
<div class="line"><a name="l00289"></a><span class="lineno"><a class="line" href="classgrepros_1_1common_1_1_progress_bar.html#acd1b00228d32592329c086639774536e">  289</a></span>&#160;        <span class="keywordflow">if</span> self.pulse:</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;            <span class="keywordflow">if</span> self.<a class="code" href="classgrepros_1_1common_1_1_progress_bar.html#a9c17a624c873883e9fccc9debdb1c10f">pulse_pos</a> <span class="keywordflow">is</span> <span class="keywordtype">None</span>:</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;                bartext = <span class="stringliteral">&quot;%s[%s]%s&quot;</span> % (self.foreword,</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;                                        self.forechar * (self.width - 2),</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;                                        afterword)</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;            <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;                dash = self.forechar * max(1, int((self.width - 2) / 7))</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;                pos = self.<a class="code" href="classgrepros_1_1common_1_1_progress_bar.html#a9c17a624c873883e9fccc9debdb1c10f">pulse_pos</a></div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;                <span class="keywordflow">if</span> pos &lt; len(dash):</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;                    dash = dash[:pos]</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;                <span class="keywordflow">elif</span> pos &gt;= self.width - 1:</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;                    dash = dash[:-(pos - self.width - 2)]</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160; </div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;                bar = <span class="stringliteral">&quot;[%s]&quot;</span> % (self.backchar * w_full)</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;                <span class="comment"># Write pulse dash into the middle of the bar</span></div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;                pos1 = min(self.width - 1, pos + 1)</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;                bar = bar[:pos1 - len(dash)] + dash + bar[pos1:]</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;                bartext = <span class="stringliteral">&quot;%s%s%s&quot;</span> % (self.foreword, bar, afterword)</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;                self.<a class="code" href="classgrepros_1_1common_1_1_progress_bar.html#a9c17a624c873883e9fccc9debdb1c10f">pulse_pos</a> = (self.<a class="code" href="classgrepros_1_1common_1_1_progress_bar.html#a9c17a624c873883e9fccc9debdb1c10f">pulse_pos</a> + 1) % (self.width + 2)</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;        <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;            percent = int(round(100.0 * self.<a class="code" href="classgrepros_1_1common_1_1_progress_bar.html#afcc7a4b78ecd8fa7e713f8cfa0f51017">value</a> / (self.max <span class="keywordflow">or</span> 1)))</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;            percent = 99 <span class="keywordflow">if</span> percent == 100 <span class="keywordflow">and</span> self.<a class="code" href="classgrepros_1_1common_1_1_progress_bar.html#afcc7a4b78ecd8fa7e713f8cfa0f51017">value</a> &lt; self.max <span class="keywordflow">else</span> percent</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;            w_done = max(1, int(round((percent / 100.0) * w_full)))</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;            <span class="comment"># Build bar outline, animate by cycling last char from progress chars</span></div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;            char_last = self.forechar</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;            <span class="keywordflow">if</span> draw <span class="keywordflow">and</span> w_done &lt; w_full: char_last = next(self.<a class="code" href="classgrepros_1_1common_1_1_progress_bar.html#a4299f0f984e2afbd4fcd4db6c744fdb5">progresschar</a>)</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;            bartext = <span class="stringliteral">&quot;%s[%s%s%s]%s&quot;</span> % (</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;                       self.foreword, self.forechar * (w_done - 1), char_last,</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;                       self.backchar * (w_full - w_done), afterword)</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;            <span class="comment"># Write percentage into the middle of the bar</span></div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;            centertxt = <span class="stringliteral">&quot; %2d%% &quot;</span> % percent</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;            pos = len(self.foreword) + int(self.width / 2 - len(centertxt) / 2)</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;            bartext = bartext[:pos] + centertxt + bartext[pos + len(centertxt):]</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;            self.<a class="code" href="classgrepros_1_1common_1_1_progress_bar.html#a174e692bc1b62677e7b4d611ed06b109">percent</a> = percent</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;        self.<a class="code" href="classgrepros_1_1common_1_1_progress_bar.html#a1702ac8242f004352282d0e43bcedaea">printbar</a> = bartext + <span class="stringliteral">&quot; &quot;</span> * max(0, len(self.<a class="code" href="classgrepros_1_1common_1_1_progress_bar.html#a5426824942db4253f87a1009fd5d2d4f">bar</a>) - len(bartext))</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;        self.<a class="code" href="classgrepros_1_1common_1_1_progress_bar.html#a5426824942db4253f87a1009fd5d2d4f">bar</a>, prevbar = bartext, self.<a class="code" href="classgrepros_1_1common_1_1_progress_bar.html#a5426824942db4253f87a1009fd5d2d4f">bar</a></div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;        <span class="keywordflow">if</span> draw <span class="keywordflow">and</span> (flush <span class="keywordflow">or</span> prevbar != self.<a class="code" href="classgrepros_1_1common_1_1_progress_bar.html#a5426824942db4253f87a1009fd5d2d4f">bar</a>): self.<a class="code" href="classgrepros_1_1common_1_1_progress_bar.html#aa7920418e8e7f7c4add4028cb48aab3f">draw</a>(flush)</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;        <span class="keywordflow">return</span> self</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160; </div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160; </div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;    <span class="keyword">def </span><a class="code" href="classgrepros_1_1common_1_1_progress_bar.html#aa7920418e8e7f7c4add4028cb48aab3f">draw</a>(self, flush=False):</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;<span class="stringliteral">        Prints the progress bar, from the beginning of the current line.</span></div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;<span class="stringliteral"></span> </div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;<span class="stringliteral">        @param   flush  add linefeed to end, forcing a new line for any next print</span></div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;<span class="stringliteral">        &quot;&quot;&quot;</span></div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;        ConsolePrinter.print(<span class="stringliteral">&quot;\r&quot;</span> + self.<a class="code" href="classgrepros_1_1common_1_1_progress_bar.html#a1702ac8242f004352282d0e43bcedaea">printbar</a>, __end=<span class="stringliteral">&quot; &quot;</span>)</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;        <span class="keywordflow">if</span> len(self.<a class="code" href="classgrepros_1_1common_1_1_progress_bar.html#a1702ac8242f004352282d0e43bcedaea">printbar</a>) != len(self.<a class="code" href="classgrepros_1_1common_1_1_progress_bar.html#a5426824942db4253f87a1009fd5d2d4f">bar</a>):  <span class="comment"># Draw twice to position caret at true content end</span></div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;            self.<a class="code" href="classgrepros_1_1common_1_1_progress_bar.html#a1702ac8242f004352282d0e43bcedaea">printbar</a> = self.<a class="code" href="classgrepros_1_1common_1_1_progress_bar.html#a5426824942db4253f87a1009fd5d2d4f">bar</a></div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;            ConsolePrinter.print(<span class="stringliteral">&quot;\r&quot;</span> + self.<a class="code" href="classgrepros_1_1common_1_1_progress_bar.html#a1702ac8242f004352282d0e43bcedaea">printbar</a>, __end=<span class="stringliteral">&quot; &quot;</span>)</div>
<div class="line"><a name="l00339"></a><span class="lineno"><a class="line" href="classgrepros_1_1common_1_1_progress_bar.html#aa7920418e8e7f7c4add4028cb48aab3f">  339</a></span>&#160;        <span class="keywordflow">if</span> flush: ConsolePrinter.flush()</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160; </div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160; </div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;    <span class="keyword">def </span><a class="code" href="classgrepros_1_1common_1_1_progress_bar.html#ad22709b2e67308af35f55680d5a026e0">run</a>(self):</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;        self.<a class="code" href="classgrepros_1_1common_1_1_progress_bar.html#ae2dc0f1c541d7886d07e3e3d7f11b643">is_running</a> = <span class="keyword">True</span></div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;        <span class="keywordflow">while</span> self.<a class="code" href="classgrepros_1_1common_1_1_progress_bar.html#ae2dc0f1c541d7886d07e3e3d7f11b643">is_running</a>:</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;            <span class="keywordflow">if</span> <span class="keywordflow">not</span> self.<a class="code" href="classgrepros_1_1common_1_1_progress_bar.html#afd7d49e17b69bd6bf3d7a649856c1067">pause</a>: self.<a class="code" href="classgrepros_1_1common_1_1_progress_bar.html#acd1b00228d32592329c086639774536e">update</a>(self.<a class="code" href="classgrepros_1_1common_1_1_progress_bar.html#afcc7a4b78ecd8fa7e713f8cfa0f51017">value</a>)</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;            time.sleep(self.interval)</div>
<div class="line"><a name="l00347"></a><span class="lineno"><a class="line" href="classgrepros_1_1common_1_1_progress_bar.html#ad22709b2e67308af35f55680d5a026e0">  347</a></span>&#160; </div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160; </div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;    <span class="keyword">def </span><a class="code" href="classgrepros_1_1common_1_1_progress_bar.html#a26ca7c1c7fcdd35378e7be97727047a6">stop</a>(self):</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;        self.<a class="code" href="classgrepros_1_1common_1_1_progress_bar.html#ae2dc0f1c541d7886d07e3e3d7f11b643">is_running</a> = <span class="keyword">False</span></div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160; </div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160; </div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160; </div>
<div class="line"><a name="l00354"></a><span class="lineno"><a class="line" href="classgrepros_1_1common_1_1_progress_bar.html#a26ca7c1c7fcdd35378e7be97727047a6">  354</a></span>&#160;<span class="keyword">class </span><a class="code" href="classgrepros_1_1common_1_1_text_wrapper.html">TextWrapper</a>(object):</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;    <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;<span class="stringliteral">    TextWrapper that supports custom substring widths in line width calculation.</span></div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;<span class="stringliteral"></span> </div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;<span class="stringliteral">    Intended for wrapping text containing ANSI control codes.</span></div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;<span class="stringliteral">    Heavily refactored from Python standard library textwrap.TextWrapper.</span></div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;<span class="stringliteral">    &quot;&quot;&quot;</span></div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160; </div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;    </div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;    SPACE_RGX = re.compile(<span class="stringliteral">r&quot;([%s]+)&quot;</span> % re.escape(<span class="stringliteral">&quot;\t\n\x0b\x0c\r &quot;</span>))</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160; </div>
<div class="line"><a name="l00365"></a><span class="lineno"><a class="line" href="classgrepros_1_1common_1_1_text_wrapper.html">  365</a></span>&#160;    </div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;    LENCACHEMAX = 10000</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160; </div>
<div class="line"><a name="l00368"></a><span class="lineno"><a class="line" href="classgrepros_1_1common_1_1_text_wrapper.html#ad9fa472611d581ffb1d3dd22f0f9c7ff">  368</a></span>&#160; </div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;    <span class="keyword">def </span><a class="code" href="classgrepros_1_1common_1_1_text_wrapper.html#aa2946015d9dc1b24300f7bb0439c6adc">__init__</a>(self, width=80, subsequent_indent=&quot;  &quot;, break_long_words=True,</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;                 drop_whitespace=False, max_lines=None, placeholder=&quot; ...&quot;, custom_widths=None):</div>
<div class="line"><a name="l00371"></a><span class="lineno"><a class="line" href="classgrepros_1_1common_1_1_text_wrapper.html#a74302178e52e1de799f3424ebe2a6d82">  371</a></span>&#160;        <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;<span class="stringliteral">        @param   width              default maximum width to wrap at, 0 disables</span></div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;<span class="stringliteral">        @param   subsequent_indent  string prepended to all consecutive lines</span></div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;<span class="stringliteral">        @param   break_long_words   break words longer than width</span></div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;<span class="stringliteral">        @param   drop_whitespace    drop leading and trailing whitespace from lines</span></div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;<span class="stringliteral">        @param   max_lines          count to truncate lines from</span></div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;<span class="stringliteral">        @param   placeholder        appended to last retained line when truncating</span></div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;<span class="stringliteral">        @param   custom_widths      {substring: len} to use in line width calculation</span></div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;<span class="stringliteral">        &quot;&quot;&quot;</span></div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;        self.<a class="code" href="classgrepros_1_1common_1_1_text_wrapper.html#a5558ace5433f9aabbf0a0ec059900d94">width</a>             = width</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;        self.<a class="code" href="classgrepros_1_1common_1_1_text_wrapper.html#a6513377ac92c85d46df28191e8b123b6">subsequent_indent</a> = subsequent_indent</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;        self.<a class="code" href="classgrepros_1_1common_1_1_text_wrapper.html#a3f0d44e708e1dd2905c55926eb782465">break_long_words</a>  = break_long_words</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;        self.<a class="code" href="classgrepros_1_1common_1_1_text_wrapper.html#a4951d21c8292a682f6d249ff375bdeb5">drop_whitespace</a>   = drop_whitespace</div>
<div class="line"><a name="l00384"></a><span class="lineno"><a class="line" href="classgrepros_1_1common_1_1_text_wrapper.html#aa2946015d9dc1b24300f7bb0439c6adc">  384</a></span>&#160;        self.<a class="code" href="classgrepros_1_1common_1_1_text_wrapper.html#a9e28a1714da334e04573f51ae2bbd8bb">max_lines</a>         = max_lines</div>
<div class="line"><a name="l00385"></a><span class="lineno"><a class="line" href="classgrepros_1_1common_1_1_text_wrapper.html#a5558ace5433f9aabbf0a0ec059900d94">  385</a></span>&#160;        self.<a class="code" href="classgrepros_1_1common_1_1_text_wrapper.html#ab73271f70effbb97663154a50a24ff00">placeholder</a>       = placeholder</div>
<div class="line"><a name="l00386"></a><span class="lineno"><a class="line" href="classgrepros_1_1common_1_1_text_wrapper.html#a6513377ac92c85d46df28191e8b123b6">  386</a></span>&#160; </div>
<div class="line"><a name="l00387"></a><span class="lineno"><a class="line" href="classgrepros_1_1common_1_1_text_wrapper.html#a3f0d44e708e1dd2905c55926eb782465">  387</a></span>&#160;        self.<a class="code" href="classgrepros_1_1common_1_1_text_wrapper.html#ad2a4bbf0c950ca89e157c4d235120a8e">lencache</a>    = {}</div>
<div class="line"><a name="l00388"></a><span class="lineno"><a class="line" href="classgrepros_1_1common_1_1_text_wrapper.html#a4951d21c8292a682f6d249ff375bdeb5">  388</a></span>&#160;        self.<a class="code" href="classgrepros_1_1common_1_1_text_wrapper.html#a146beaa715edc2d5a95859b066a631aa">customs</a>     = {s: l <span class="keywordflow">for</span> s, l <span class="keywordflow">in</span> (custom_widths <span class="keywordflow">or</span> {}).items() <span class="keywordflow">if</span> s}</div>
<div class="line"><a name="l00389"></a><span class="lineno"><a class="line" href="classgrepros_1_1common_1_1_text_wrapper.html#a9e28a1714da334e04573f51ae2bbd8bb">  389</a></span>&#160;        self.<a class="code" href="classgrepros_1_1common_1_1_text_wrapper.html#aa6a15ee24d54eae658b86b0257188f91">custom_lens</a> = [(s, len(s) - l) <span class="keywordflow">for</span> s, l <span class="keywordflow">in</span> self.<a class="code" href="classgrepros_1_1common_1_1_text_wrapper.html#a146beaa715edc2d5a95859b066a631aa">customs</a>.items()]</div>
<div class="line"><a name="l00390"></a><span class="lineno"><a class="line" href="classgrepros_1_1common_1_1_text_wrapper.html#ab73271f70effbb97663154a50a24ff00">  390</a></span>&#160;        self.<a class="code" href="classgrepros_1_1common_1_1_text_wrapper.html#a815024d0c2db3754f20d8f1caebb45df">custom_rgx</a>  = re.compile(<span class="stringliteral">&quot;(%s)&quot;</span> % <span class="stringliteral">&quot;|&quot;</span>.join(re.escape(s) <span class="keywordflow">for</span> s <span class="keywordflow">in</span> self.<a class="code" href="classgrepros_1_1common_1_1_text_wrapper.html#a146beaa715edc2d5a95859b066a631aa">customs</a>))</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;        self.<a class="code" href="classgrepros_1_1common_1_1_text_wrapper.html#a167f3d1d219cdeb0285ec26cc28c2275">disabled</a>    = <span class="keywordflow">not</span> self.<a class="code" href="classgrepros_1_1common_1_1_text_wrapper.html#a5558ace5433f9aabbf0a0ec059900d94">width</a></div>
<div class="line"><a name="l00392"></a><span class="lineno"><a class="line" href="classgrepros_1_1common_1_1_text_wrapper.html#ad2a4bbf0c950ca89e157c4d235120a8e">  392</a></span>&#160;        self.<a class="code" href="classgrepros_1_1common_1_1_text_wrapper.html#a84685ed0862a8dcda5f320f131464797">minwidth</a>    = 1 + self.<a class="code" href="classgrepros_1_1common_1_1_text_wrapper.html#a691096ca68413d152adb147808c9330f">strlen</a>(self.<a class="code" href="classgrepros_1_1common_1_1_text_wrapper.html#a6513377ac92c85d46df28191e8b123b6">subsequent_indent</a>) \</div>
<div class="line"><a name="l00393"></a><span class="lineno"><a class="line" href="classgrepros_1_1common_1_1_text_wrapper.html#a146beaa715edc2d5a95859b066a631aa">  393</a></span>&#160;                             + self.<a class="code" href="classgrepros_1_1common_1_1_text_wrapper.html#a691096ca68413d152adb147808c9330f">strlen</a>(self.<a class="code" href="classgrepros_1_1common_1_1_text_wrapper.html#ab73271f70effbb97663154a50a24ff00">placeholder</a> <span class="keywordflow">if</span> self.<a class="code" href="classgrepros_1_1common_1_1_text_wrapper.html#a9e28a1714da334e04573f51ae2bbd8bb">max_lines</a> <span class="keywordflow">else</span> <span class="stringliteral">&quot;&quot;</span>)</div>
<div class="line"><a name="l00394"></a><span class="lineno"><a class="line" href="classgrepros_1_1common_1_1_text_wrapper.html#aa6a15ee24d54eae658b86b0257188f91">  394</a></span>&#160;        self.<a class="code" href="classgrepros_1_1common_1_1_text_wrapper.html#a5558ace5433f9aabbf0a0ec059900d94">width</a>       = max(self.<a class="code" href="classgrepros_1_1common_1_1_text_wrapper.html#a5558ace5433f9aabbf0a0ec059900d94">width</a>, self.<a class="code" href="classgrepros_1_1common_1_1_text_wrapper.html#a84685ed0862a8dcda5f320f131464797">minwidth</a>)</div>
<div class="line"><a name="l00395"></a><span class="lineno"><a class="line" href="classgrepros_1_1common_1_1_text_wrapper.html#a815024d0c2db3754f20d8f1caebb45df">  395</a></span>&#160;        self.<a class="code" href="classgrepros_1_1common_1_1_text_wrapper.html#a081090be3d428541490bb48323877653">realwidth</a>   = self.<a class="code" href="classgrepros_1_1common_1_1_text_wrapper.html#a5558ace5433f9aabbf0a0ec059900d94">width</a></div>
<div class="line"><a name="l00396"></a><span class="lineno"><a class="line" href="classgrepros_1_1common_1_1_text_wrapper.html#a167f3d1d219cdeb0285ec26cc28c2275">  396</a></span>&#160; </div>
<div class="line"><a name="l00397"></a><span class="lineno"><a class="line" href="classgrepros_1_1common_1_1_text_wrapper.html#a84685ed0862a8dcda5f320f131464797">  397</a></span>&#160; </div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;    <span class="keyword">def </span><a class="code" href="classgrepros_1_1common_1_1_text_wrapper.html#ae79644dfff8aaf480fb1c314b52d48b4">wrap</a>(self, text):</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;Returns a list of wrapped text lines, without linebreaks.&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00400"></a><span class="lineno"><a class="line" href="classgrepros_1_1common_1_1_text_wrapper.html#a081090be3d428541490bb48323877653">  400</a></span>&#160;        <span class="keywordflow">if</span> self.<a class="code" href="classgrepros_1_1common_1_1_text_wrapper.html#a167f3d1d219cdeb0285ec26cc28c2275">disabled</a>: <span class="keywordflow">return</span> [text]</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;        result = []</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;        <span class="keywordflow">for</span> i, line <span class="keywordflow">in</span> enumerate(text.splitlines()):</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;            chunks = [c <span class="keywordflow">for</span> c <span class="keywordflow">in</span> self.<a class="code" href="classgrepros_1_1common_1_1_text_wrapper.html#ad9fa472611d581ffb1d3dd22f0f9c7ff">SPACE_RGX</a>.split(line) <span class="keywordflow">if</span> c]</div>
<div class="line"><a name="l00404"></a><span class="lineno"><a class="line" href="classgrepros_1_1common_1_1_text_wrapper.html#ae79644dfff8aaf480fb1c314b52d48b4">  404</a></span>&#160;            lines = self.<a class="code" href="classgrepros_1_1common_1_1_text_wrapper.html#a6c35974db1e392b4e51332d47159681e">_wrap_chunks</a>(chunks)</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;            <span class="keywordflow">if</span> i <span class="keywordflow">and</span> lines <span class="keywordflow">and</span> self.<a class="code" href="classgrepros_1_1common_1_1_text_wrapper.html#a6513377ac92c85d46df28191e8b123b6">subsequent_indent</a>:</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;                lines[0] = self.<a class="code" href="classgrepros_1_1common_1_1_text_wrapper.html#a6513377ac92c85d46df28191e8b123b6">subsequent_indent</a> + lines[0]</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;            result.extend(lines)</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;            <span class="keywordflow">if</span> self.<a class="code" href="classgrepros_1_1common_1_1_text_wrapper.html#a9e28a1714da334e04573f51ae2bbd8bb">max_lines</a> <span class="keywordflow">and</span> result <span class="keywordflow">and</span> len(result) &gt;= self.<a class="code" href="classgrepros_1_1common_1_1_text_wrapper.html#a9e28a1714da334e04573f51ae2bbd8bb">max_lines</a>:</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;                <span class="keywordflow">break</span>  <span class="comment"># for i, line</span></div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;        <span class="keywordflow">if</span> self.<a class="code" href="classgrepros_1_1common_1_1_text_wrapper.html#a9e28a1714da334e04573f51ae2bbd8bb">max_lines</a> <span class="keywordflow">and</span> result <span class="keywordflow">and</span> (len(result) &gt; self.<a class="code" href="classgrepros_1_1common_1_1_text_wrapper.html#a9e28a1714da334e04573f51ae2bbd8bb">max_lines</a></div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;        <span class="keywordflow">or</span> len(result) == self.<a class="code" href="classgrepros_1_1common_1_1_text_wrapper.html#a9e28a1714da334e04573f51ae2bbd8bb">max_lines</a> <span class="keywordflow">and</span> <span class="keywordflow">not</span> text.endswith(result[-1].<a class="code" href="classgrepros_1_1common_1_1_text_wrapper.html#a2354be14036ab63e94d74cd4f5ba1959">strip</a>())):</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;            result = result[:self.<a class="code" href="classgrepros_1_1common_1_1_text_wrapper.html#a9e28a1714da334e04573f51ae2bbd8bb">max_lines</a>]</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;            <span class="keywordflow">if</span> <span class="keywordflow">not</span> result[-1].endswith(self.<a class="code" href="classgrepros_1_1common_1_1_text_wrapper.html#ab73271f70effbb97663154a50a24ff00">placeholder</a>.lstrip()):</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;                result[-1] += self.<a class="code" href="classgrepros_1_1common_1_1_text_wrapper.html#ab73271f70effbb97663154a50a24ff00">placeholder</a></div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;        <span class="keywordflow">if</span> len(self.<a class="code" href="classgrepros_1_1common_1_1_text_wrapper.html#ad2a4bbf0c950ca89e157c4d235120a8e">lencache</a>)  &gt; self.<a class="code" href="classgrepros_1_1common_1_1_text_wrapper.html#a74302178e52e1de799f3424ebe2a6d82">LENCACHEMAX</a>:  self.<a class="code" href="classgrepros_1_1common_1_1_text_wrapper.html#ad2a4bbf0c950ca89e157c4d235120a8e">lencache</a>.clear()</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;        <span class="keywordflow">return</span> result</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160; </div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160; </div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;    <span class="keyword">def </span><a class="code" href="classgrepros_1_1common_1_1_text_wrapper.html#ae02c47a0db2c25ceda38c474a35398a6">reserve_width</a>(self, reserved=&quot;&quot;):</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;Decreases the configured width by given amount (number or string).&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;        reserved = self.<a class="code" href="classgrepros_1_1common_1_1_text_wrapper.html#a691096ca68413d152adb147808c9330f">strlen</a>(reserved) <span class="keywordflow">if</span> isinstance(reserved, str) <span class="keywordflow">else</span> reserved</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;        self.<a class="code" href="classgrepros_1_1common_1_1_text_wrapper.html#a5558ace5433f9aabbf0a0ec059900d94">width</a> = max(self.<a class="code" href="classgrepros_1_1common_1_1_text_wrapper.html#a84685ed0862a8dcda5f320f131464797">minwidth</a>, self.<a class="code" href="classgrepros_1_1common_1_1_text_wrapper.html#a081090be3d428541490bb48323877653">realwidth</a> - reserved)</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160; </div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160; </div>
<div class="line"><a name="l00425"></a><span class="lineno"><a class="line" href="classgrepros_1_1common_1_1_text_wrapper.html#ae02c47a0db2c25ceda38c474a35398a6">  425</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classgrepros_1_1common_1_1_text_wrapper.html#a691096ca68413d152adb147808c9330f">strlen</a>(self, v):</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;Returns length of string, using custom substring widths.&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;        <span class="keywordflow">if</span> v <span class="keywordflow">not</span> <span class="keywordflow">in</span> self.<a class="code" href="classgrepros_1_1common_1_1_text_wrapper.html#ad2a4bbf0c950ca89e157c4d235120a8e">lencache</a>:</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;            self.<a class="code" href="classgrepros_1_1common_1_1_text_wrapper.html#ad2a4bbf0c950ca89e157c4d235120a8e">lencache</a>[v] = len(v) - sum(v.count(s) * ld <span class="keywordflow">for</span> s, ld <span class="keywordflow">in</span> self.<a class="code" href="classgrepros_1_1common_1_1_text_wrapper.html#aa6a15ee24d54eae658b86b0257188f91">custom_lens</a>)</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;        <span class="keywordflow">return</span> self.<a class="code" href="classgrepros_1_1common_1_1_text_wrapper.html#ad2a4bbf0c950ca89e157c4d235120a8e">lencache</a>[v]</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160; </div>
<div class="line"><a name="l00431"></a><span class="lineno"><a class="line" href="classgrepros_1_1common_1_1_text_wrapper.html#a691096ca68413d152adb147808c9330f">  431</a></span>&#160; </div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;    <span class="keyword">def </span><a class="code" href="classgrepros_1_1common_1_1_text_wrapper.html#a2354be14036ab63e94d74cd4f5ba1959">strip</a>(self, v):</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;Returns string with custom substrings and whitespace stripped.&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;        <span class="keywordflow">return</span> self.<a class="code" href="classgrepros_1_1common_1_1_text_wrapper.html#a815024d0c2db3754f20d8f1caebb45df">custom_rgx</a>.sub(<span class="stringliteral">&quot;&quot;</span>, v).<a class="code" href="classgrepros_1_1common_1_1_text_wrapper.html#a2354be14036ab63e94d74cd4f5ba1959">strip</a>()</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160; </div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160; </div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;    <span class="keyword">def </span>_wrap_chunks(self, chunks):</div>
<div class="line"><a name="l00438"></a><span class="lineno"><a class="line" href="classgrepros_1_1common_1_1_text_wrapper.html#a2354be14036ab63e94d74cd4f5ba1959">  438</a></span>&#160;        <span class="stringliteral">&quot;&quot;&quot;Returns a list of lines joined from text chunks, wrapped to width.&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;        lines = []</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;        chunks.reverse()  <span class="comment"># Reverse for efficient popping</span></div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160; </div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;        placeholder_len = self.<a class="code" href="classgrepros_1_1common_1_1_text_wrapper.html#a691096ca68413d152adb147808c9330f">strlen</a>(self.<a class="code" href="classgrepros_1_1common_1_1_text_wrapper.html#ab73271f70effbb97663154a50a24ff00">placeholder</a>)</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;        <span class="keywordflow">while</span> chunks:</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;            cur_line, cur_len = [], 0  <span class="comment"># [chunk, ], sum(map(len, cur_line))</span></div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;            indent = self.<a class="code" href="classgrepros_1_1common_1_1_text_wrapper.html#a6513377ac92c85d46df28191e8b123b6">subsequent_indent</a> <span class="keywordflow">if</span> lines <span class="keywordflow">else</span> <span class="stringliteral">&quot;&quot;</span></div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;            width = self.<a class="code" href="classgrepros_1_1common_1_1_text_wrapper.html#a5558ace5433f9aabbf0a0ec059900d94">width</a> - self.<a class="code" href="classgrepros_1_1common_1_1_text_wrapper.html#a691096ca68413d152adb147808c9330f">strlen</a>(indent)</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160; </div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;            <span class="keywordflow">if</span> self.<a class="code" href="classgrepros_1_1common_1_1_text_wrapper.html#a4951d21c8292a682f6d249ff375bdeb5">drop_whitespace</a> <span class="keywordflow">and</span> lines <span class="keywordflow">and</span> <span class="keywordflow">not</span> self.<a class="code" href="classgrepros_1_1common_1_1_text_wrapper.html#a2354be14036ab63e94d74cd4f5ba1959">strip</a>(chunks[-1]):</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;                del chunks[-1]  <span class="comment"># Drop initial whitespace on subsequent lines</span></div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160; </div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;            <span class="keywordflow">while</span> chunks:</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;                l = self.<a class="code" href="classgrepros_1_1common_1_1_text_wrapper.html#a691096ca68413d152adb147808c9330f">strlen</a>(chunks[-1])</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;                <span class="keywordflow">if</span> cur_len + l &lt;= width:</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;                    cur_line.append(chunks.pop())</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;                    cur_len += l</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;                <span class="keywordflow">else</span>:  <span class="comment"># Line full</span></div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;                    <span class="keywordflow">break</span>  <span class="comment"># while chunks (inner-while)</span></div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160; </div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;            <span class="keywordflow">if</span> chunks <span class="keywordflow">and</span> self.<a class="code" href="classgrepros_1_1common_1_1_text_wrapper.html#a691096ca68413d152adb147808c9330f">strlen</a>(chunks[-1]) &gt; width:</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;                <span class="comment"># Current line is full, and next chunk is too big to fit on any line</span></div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;                self.<a class="code" href="classgrepros_1_1common_1_1_text_wrapper.html#a0ad5c469cfa34f578ef4fe584e84a8c7">_handle_long_word</a>(chunks, cur_line, cur_len, width)</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;                cur_len = sum(map(self.<a class="code" href="classgrepros_1_1common_1_1_text_wrapper.html#a691096ca68413d152adb147808c9330f">strlen</a>, cur_line))</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160; </div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;            <span class="keywordflow">if</span> self.<a class="code" href="classgrepros_1_1common_1_1_text_wrapper.html#a4951d21c8292a682f6d249ff375bdeb5">drop_whitespace</a> <span class="keywordflow">and</span> cur_line <span class="keywordflow">and</span> <span class="keywordflow">not</span> self.<a class="code" href="classgrepros_1_1common_1_1_text_wrapper.html#a2354be14036ab63e94d74cd4f5ba1959">strip</a>(cur_line[-1]):</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;                cur_len -= len(cur_line[-1])  <span class="comment"># Drop line last whitespace chunk</span></div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;                del cur_line[-1]</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160; </div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;            <span class="keywordflow">if</span> cur_line:</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;                <span class="keywordflow">if</span> (self.<a class="code" href="classgrepros_1_1common_1_1_text_wrapper.html#a9e28a1714da334e04573f51ae2bbd8bb">max_lines</a> <span class="keywordflow">is</span> <span class="keywordtype">None</span> <span class="keywordflow">or</span> len(lines) + 1 &lt; self.<a class="code" href="classgrepros_1_1common_1_1_text_wrapper.html#a9e28a1714da334e04573f51ae2bbd8bb">max_lines</a></div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;                <span class="keywordflow">or</span> (<span class="keywordflow">not</span> chunks <span class="keywordflow">or</span> self.<a class="code" href="classgrepros_1_1common_1_1_text_wrapper.html#a4951d21c8292a682f6d249ff375bdeb5">drop_whitespace</a></div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;                    <span class="keywordflow">and</span> len(chunks) == 1 <span class="keywordflow">and</span> <span class="keywordflow">not</span> self.<a class="code" href="classgrepros_1_1common_1_1_text_wrapper.html#a2354be14036ab63e94d74cd4f5ba1959">strip</a>(chunks[0])) \</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;                <span class="keywordflow">and</span> cur_len &lt;= width):  <span class="comment"># Current line ok</span></div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;                    lines.append(indent + <span class="stringliteral">&quot;&quot;</span>.join(cur_line))</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;                    <span class="keywordflow">continue</span>  <span class="comment"># while chunks</span></div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;            <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;                <span class="keywordflow">continue</span>  <span class="comment"># while chunks</span></div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160; </div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;            <span class="keywordflow">while</span> cur_line:  <span class="comment"># Truncate for max_lines</span></div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;                <span class="keywordflow">if</span> self.<a class="code" href="classgrepros_1_1common_1_1_text_wrapper.html#a2354be14036ab63e94d74cd4f5ba1959">strip</a>(cur_line[-1]):</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;                    <span class="keywordflow">if</span> cur_len + placeholder_len &lt;= width:</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;                        lines.append(indent + <span class="stringliteral">&quot;&quot;</span>.join(cur_line))</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;                        <span class="keywordflow">break</span>  <span class="comment"># while cur_line</span></div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;                    <span class="keywordflow">if</span> len(cur_line) == 1:</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;                        lines.append(indent + cur_line[-1])</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;                cur_len -= self.<a class="code" href="classgrepros_1_1common_1_1_text_wrapper.html#a691096ca68413d152adb147808c9330f">strlen</a>(cur_line[-1])</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;                del cur_line[-1]</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;            <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;                <span class="keywordflow">if</span> <span class="keywordflow">not</span> lines <span class="keywordflow">or</span> self.<a class="code" href="classgrepros_1_1common_1_1_text_wrapper.html#a691096ca68413d152adb147808c9330f">strlen</a>(lines[-1]) + placeholder_len &gt; self.<a class="code" href="classgrepros_1_1common_1_1_text_wrapper.html#a5558ace5433f9aabbf0a0ec059900d94">width</a>:</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;                    lines.append(indent + self.<a class="code" href="classgrepros_1_1common_1_1_text_wrapper.html#ab73271f70effbb97663154a50a24ff00">placeholder</a>.lstrip())</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;            <span class="keywordflow">break</span>  <span class="comment"># while chunks</span></div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160; </div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;        <span class="keywordflow">return</span> lines</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160; </div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160; </div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;    <span class="keyword">def </span>_handle_long_word(self, reversed_chunks, cur_line, cur_len, width):</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;<span class="stringliteral">        Breaks last chunk if not only containing a custom-width string,</span></div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;<span class="stringliteral">        else adds last chunk to current line if line still empty.</span></div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;<span class="stringliteral">        &quot;&quot;&quot;</span></div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;        text = reversed_chunks[-1]</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;        break_pos = 1 <span class="keywordflow">if</span> width &lt; 1 <span class="keywordflow">else</span> width - cur_len</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;        breakable = self.<a class="code" href="classgrepros_1_1common_1_1_text_wrapper.html#a3f0d44e708e1dd2905c55926eb782465">break_long_words</a> <span class="keywordflow">and</span> text <span class="keywordflow">not</span> <span class="keywordflow">in</span> self.<a class="code" href="classgrepros_1_1common_1_1_text_wrapper.html#a146beaa715edc2d5a95859b066a631aa">customs</a></div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;        <span class="keywordflow">if</span> breakable:</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;            unbreakable_spans = [m.span() <span class="keywordflow">for</span> m <span class="keywordflow">in</span> self.<a class="code" href="classgrepros_1_1common_1_1_text_wrapper.html#a815024d0c2db3754f20d8f1caebb45df">custom_rgx</a>.finditer(text)]</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;            text_in_spans = [x <span class="keywordflow">for</span> x <span class="keywordflow">in</span> unbreakable_spans <span class="keywordflow">if</span> x[0] &lt;= break_pos &lt; x[1]]</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;            last_span = text_in_spans <span class="keywordflow">and</span> sorted(text_in_spans, key=<span class="keyword">lambda</span> x: -x[1])[0]</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;            break_pos = last_span[1] <span class="keywordflow">if</span> last_span <span class="keywordflow">else</span> break_pos</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;            breakable = 0 &lt; break_pos &lt; len(text)</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160; </div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;        <span class="keywordflow">if</span> breakable:</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;            cur_line.append(text[:break_pos])</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;            reversed_chunks[-1] = text[break_pos:]</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;        <span class="keywordflow">elif</span> <span class="keywordflow">not</span> cur_line:</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;            cur_line.append(reversed_chunks.pop())</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160; </div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160; </div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160; </div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;<span class="keyword">def </span><a class="code" href="namespacegrepros_1_1common.html#a9bee8d7c9fbeb34db4bd9e2153975d60">drop_zeros</a>(v, replace=&quot;&quot;):</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;    <span class="stringliteral">&quot;&quot;&quot;Drops or replaces trailing zeros and empty decimal separator, if any.&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;    <span class="keywordflow">return</span> re.sub(<span class="stringliteral">r&quot;\.?0+$&quot;</span>, <span class="keyword">lambda</span> x: len(x.group()) * replace, str(v))</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160; </div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160; </div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;<span class="keyword">def </span><a class="code" href="namespacegrepros_1_1common.html#acf36aeb58c7754bfe76d3e0f36003584">ellipsize</a>(text, limit, ellipsis=&quot;..&quot;):</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;    <span class="stringliteral">&quot;&quot;&quot;Returns text ellipsized if beyond limit.&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;    <span class="keywordflow">if</span> limit &lt;= 0 <span class="keywordflow">or</span> len(text) &lt; limit:</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;        <span class="keywordflow">return</span> text</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;    <span class="keywordflow">return</span> text[:max(0, limit - len(ellipsis))] + ellipsis</div>
<div class="line"><a name="l00528"></a><span class="lineno"><a class="line" href="namespacegrepros_1_1common.html#a9bee8d7c9fbeb34db4bd9e2153975d60">  528</a></span>&#160; </div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160; </div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;<span class="keyword">def </span><a class="code" href="namespacegrepros_1_1common.html#a8e02f5d98e712b40b989993d1820be89">filter_dict</a>(dct, keys=(), values=(), reverse=<span class="keyword">False</span>):</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;    <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;<span class="stringliteral">    Filters string dictionary by keys and values. Dictionary values may be</span></div>
<div class="line"><a name="l00533"></a><span class="lineno"><a class="line" href="namespacegrepros_1_1common.html#acf36aeb58c7754bfe76d3e0f36003584">  533</a></span>&#160;<span class="stringliteral">    additional lists; keys with emptied lists are dropped.</span></div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;<span class="stringliteral"></span> </div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;<span class="stringliteral">    Retains only entries that find a match (supports * wildcards);</span></div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;<span class="stringliteral">    if reverse, retains only entries that do not find a match.</span></div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;<span class="stringliteral">    &quot;&quot;&quot;</span></div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;    result = type(dct)()</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;    kpatterns = [<a class="code" href="namespacegrepros_1_1common.html#a496d7f7b3f426bbb399714a049d49a52">wildcard_to_regex</a>(x) <span class="keywordflow">for</span> x <span class="keywordflow">in</span> keys]</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;    vpatterns = [<a class="code" href="namespacegrepros_1_1common.html#a496d7f7b3f426bbb399714a049d49a52">wildcard_to_regex</a>(x) <span class="keywordflow">for</span> x <span class="keywordflow">in</span> values]</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;    <span class="keywordflow">for</span> k, vv <span class="keywordflow">in</span> dct.items() <span class="keywordflow">if</span> <span class="keywordflow">not</span> reverse <span class="keywordflow">else</span> ():</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;        is_array = isinstance(vv, (list, tuple))</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;        <span class="keywordflow">for</span> v <span class="keywordflow">in</span> (vv <span class="keywordflow">if</span> is_array <span class="keywordflow">else</span> [vv]):</div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;            <span class="keywordflow">if</span>  (<span class="keywordflow">not</span> keys   <span class="keywordflow">or</span> k <span class="keywordflow">in</span> keys   <span class="keywordflow">or</span> any(p.match(k) <span class="keywordflow">for</span> p <span class="keywordflow">in</span> kpatterns)) \</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;            <span class="keywordflow">and</span> (<span class="keywordflow">not</span> values <span class="keywordflow">or</span> v <span class="keywordflow">in</span> values <span class="keywordflow">or</span> any(p.match(v) <span class="keywordflow">for</span> p <span class="keywordflow">in</span> vpatterns)):</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;                result.setdefault(k, []).append(v) <span class="keywordflow">if</span> is_array <span class="keywordflow">else</span> result.update({k: v})</div>
<div class="line"><a name="l00547"></a><span class="lineno"><a class="line" href="namespacegrepros_1_1common.html#a8e02f5d98e712b40b989993d1820be89">  547</a></span>&#160;    <span class="keywordflow">for</span> k, vv <span class="keywordflow">in</span> dct.items() <span class="keywordflow">if</span> reverse <span class="keywordflow">else</span> ():</div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;        is_array = isinstance(vv, (list, tuple))</div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;        <span class="keywordflow">for</span> v <span class="keywordflow">in</span> (vv <span class="keywordflow">if</span> is_array <span class="keywordflow">else</span> [vv]):</div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;            <span class="keywordflow">if</span>  (k <span class="keywordflow">not</span> <span class="keywordflow">in</span> keys   <span class="keywordflow">and</span> <span class="keywordflow">not</span> any(p.match(k) <span class="keywordflow">for</span> p <span class="keywordflow">in</span> kpatterns)) \</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;            <span class="keywordflow">and</span> (v <span class="keywordflow">not</span> <span class="keywordflow">in</span> values <span class="keywordflow">and</span> <span class="keywordflow">not</span> any(p.match(v) <span class="keywordflow">for</span> p <span class="keywordflow">in</span> vpatterns)):</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;                result.setdefault(k, []).append(v) <span class="keywordflow">if</span> is_array <span class="keywordflow">else</span> result.update({k: v})</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;    <span class="keywordflow">return</span> result</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160; </div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160; </div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;<span class="keyword">def </span><a class="code" href="namespacegrepros_1_1common.html#aea9cbadf70cd7ea687a1d4b120529822">filter_fields</a>(fieldmap, top=(), include=(), exclude=()):</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;    <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;<span class="stringliteral">    Returns fieldmap filtered by include and exclude patterns.</span></div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;<span class="stringliteral"></span> </div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;<span class="stringliteral">    @param   fieldmap  {field name: field type name}</span></div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;<span class="stringliteral">    @param   top       parent path as (rootattr, ..)</span></div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;<span class="stringliteral">    @param   include   [((nested, path), re.Pattern())] to require in parent path</span></div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;<span class="stringliteral">    @param   exclude   [((nested, path), re.Pattern())] to reject in parent path</span></div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;<span class="stringliteral">    &quot;&quot;&quot;</span></div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;    result = type(fieldmap)() <span class="keywordflow">if</span> include <span class="keywordflow">or</span> exclude <span class="keywordflow">else</span> fieldmap</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;    <span class="keywordflow">for</span> k, v <span class="keywordflow">in</span> fieldmap.items() <span class="keywordflow">if</span> <span class="keywordflow">not</span> result <span class="keywordflow">else</span> ():</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;        trail, trailstr = top + (k, ), <span class="stringliteral">&quot;.&quot;</span>.join(top + (k, ))</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;        <span class="keywordflow">for</span> is_exclude, patterns <span class="keywordflow">in</span> enumerate((include, exclude)):</div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;            matches = any(p[:len(trail)] == trail[:len(p)] <span class="keywordflow">or</span> r.match(trailstr)</div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;                          <span class="keywordflow">for</span> p, r <span class="keywordflow">in</span> patterns)  <span class="comment"># Match by beginning or wildcard pattern</span></div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;            <span class="keywordflow">if</span> patterns <span class="keywordflow">and</span> (<span class="keywordflow">not</span> matches <span class="keywordflow">if</span> is_exclude <span class="keywordflow">else</span> matches):</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;                result[k] = v</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;            <span class="keywordflow">elif</span> patterns <span class="keywordflow">and</span> is_exclude <span class="keywordflow">and</span> matches:</div>
<div class="line"><a name="l00574"></a><span class="lineno"><a class="line" href="namespacegrepros_1_1common.html#aea9cbadf70cd7ea687a1d4b120529822">  574</a></span>&#160;                result.pop(k, <span class="keywordtype">None</span>)</div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;            <span class="keywordflow">if</span> include <span class="keywordflow">and</span> exclude <span class="keywordflow">and</span> k <span class="keywordflow">not</span> <span class="keywordflow">in</span> result:  <span class="comment"># Failing to include takes precedence</span></div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;                <span class="keywordflow">break</span>  <span class="comment"># for is_exclude</span></div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;    <span class="keywordflow">return</span> result</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160; </div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160; </div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;<span class="keyword">def </span><a class="code" href="namespacegrepros_1_1common.html#af1be1d815c8bf65b1d8c4b6c1b2f5130">find_files</a>(names=(), paths=(), extensions=(), skip_extensions=(), recurse=<span class="keyword">False</span>):</div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;    <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;<span class="stringliteral">    Yields filenames from current directory or given paths, .</span></div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;<span class="stringliteral"></span> </div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;<span class="stringliteral">    Seeks only files with given extensions if names not given.</span></div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;<span class="stringliteral">    Prints errors for names and paths not found.</span></div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;<span class="stringliteral"></span> </div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;<span class="stringliteral">    @param   names            list of specific files to return (supports * wildcards)</span></div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;<span class="stringliteral">    @param   paths            list of paths to look under, if not using current directory</span></div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;<span class="stringliteral">    @param   extensions       list of extensions to select if not using names, as (&quot;.ext1&quot;, ..)</span></div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;<span class="stringliteral">    @param   skip_extensions  list of extensions to skip if not using names, as (&quot;.ext1&quot;, ..)</span></div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;<span class="stringliteral">    @param   recurse          whether to recurse into subdirectories</span></div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;<span class="stringliteral">    &quot;&quot;&quot;</span></div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;    namesfound, pathsfound = set(), set()</div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;    <span class="keyword">def </span>iter_files(directory):</div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;Yields matching filenames from path.&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;        <span class="keywordflow">if</span> os.path.isfile(directory):</div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;            ConsolePrinter.error(<span class="stringliteral">&quot;%s: Is a file&quot;</span>, directory)</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;            <span class="keywordflow">return</span></div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;        <span class="keywordflow">for</span> path <span class="keywordflow">in</span> sorted(glob.glob(directory)):  <span class="comment"># Expand * wildcards, if any</span></div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;            pathsfound.add(directory)</div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;            <span class="keywordflow">for</span> n <span class="keywordflow">in</span> names:</div>
<div class="line"><a name="l00602"></a><span class="lineno"><a class="line" href="namespacegrepros_1_1common.html#af1be1d815c8bf65b1d8c4b6c1b2f5130">  602</a></span>&#160;                p = n <span class="keywordflow">if</span> <span class="keywordflow">not</span> paths <span class="keywordflow">or</span> os.path.isabs(n) <span class="keywordflow">else</span> os.path.join(path, n)</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;                <span class="keywordflow">for</span> f <span class="keywordflow">in</span> (f <span class="keywordflow">for</span> f <span class="keywordflow">in</span> glob.glob(p) <span class="keywordflow">if</span> <span class="stringliteral">&quot;*&quot;</span> <span class="keywordflow">not</span> <span class="keywordflow">in</span> n</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;                          <span class="keywordflow">or</span> <span class="keywordflow">not</span> any(map(f.endswith, skip_extensions))):</div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;                    <span class="keywordflow">if</span> os.path.isdir(f):</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;                        ConsolePrinter.error(<span class="stringliteral">&quot;%s: Is a directory&quot;</span>, f)</div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;                        <span class="keywordflow">continue</span>  <span class="comment"># for n</span></div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;                    namesfound.add(n)</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;                    <span class="keywordflow">yield</span> f</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;            <span class="keywordflow">for</span> root, _, files <span class="keywordflow">in</span> os.walk(path) <span class="keywordflow">if</span> <span class="keywordflow">not</span> names <span class="keywordflow">else</span> ():</div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;                <span class="keywordflow">for</span> f <span class="keywordflow">in</span> (os.path.join(root, f) <span class="keywordflow">for</span> f <span class="keywordflow">in</span> sorted(files)</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;                          <span class="keywordflow">if</span> (<span class="keywordflow">not</span> extensions <span class="keywordflow">or</span> any(map(f.endswith, extensions)))</div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;                          <span class="keywordflow">and</span> <span class="keywordflow">not</span> any(map(f.endswith, skip_extensions))):</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;                    <span class="keywordflow">yield</span> f</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;                <span class="keywordflow">if</span> <span class="keywordflow">not</span> recurse:</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;                    <span class="keywordflow">break</span>  <span class="comment"># for root</span></div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160; </div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;    processed = set()</div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;    <span class="keywordflow">for</span> f <span class="keywordflow">in</span> (f <span class="keywordflow">for</span> p <span class="keywordflow">in</span> paths <span class="keywordflow">or</span> [<span class="stringliteral">&quot;.&quot;</span>] <span class="keywordflow">for</span> f <span class="keywordflow">in</span> iter_files(p)):</div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;        <span class="keywordflow">if</span> os.path.abspath(f) <span class="keywordflow">not</span> <span class="keywordflow">in</span> processed:</div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;            processed.add(os.path.abspath(f))</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;            <span class="keywordflow">if</span> <span class="keywordflow">not</span> paths <span class="keywordflow">and</span> f == os.path.join(<span class="stringliteral">&quot;.&quot;</span>, os.path.basename(f)):</div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;                f = os.path.basename(f)  <span class="comment"># Strip leading &quot;./&quot;</span></div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;            <span class="keywordflow">yield</span> f</div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160; </div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;    <span class="keywordflow">for</span> path <span class="keywordflow">in</span> (p <span class="keywordflow">for</span> p <span class="keywordflow">in</span> paths <span class="keywordflow">if</span> p <span class="keywordflow">not</span> <span class="keywordflow">in</span> pathsfound):</div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;        ConsolePrinter.error(<span class="stringliteral">&quot;%s: No such directory&quot;</span>, path)</div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;    <span class="keywordflow">for</span> name <span class="keywordflow">in</span> (n <span class="keywordflow">for</span> n <span class="keywordflow">in</span> names <span class="keywordflow">if</span> n <span class="keywordflow">not</span> <span class="keywordflow">in</span> namesfound):</div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;        ConsolePrinter.error(<span class="stringliteral">&quot;%s: No such file&quot;</span>, name)</div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160; </div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160; </div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;<span class="keyword">def </span><a class="code" href="namespacegrepros_1_1common.html#a1a227cb39eb9a23c864977273f2a3c1b">format_timedelta</a>(delta):</div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;    <span class="stringliteral">&quot;&quot;&quot;Formats the datetime.timedelta as &quot;3d 40h 23min 23.1sec&quot;.&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;    dd, rem = divmod(delta.total_seconds(), 24*3600)</div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;    hh, rem = divmod(rem, 3600)</div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;    mm, ss  = divmod(rem, 60)</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;    items = []</div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;    <span class="keywordflow">for</span> c, n <span class="keywordflow">in</span> (dd, <span class="stringliteral">&quot;d&quot;</span>), (hh, <span class="stringliteral">&quot;h&quot;</span>), (mm, <span class="stringliteral">&quot;min&quot;</span>), (ss, <span class="stringliteral">&quot;sec&quot;</span>):</div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;        f = <span class="stringliteral">&quot;%d&quot;</span> % c <span class="keywordflow">if</span> <span class="stringliteral">&quot;sec&quot;</span> != n <span class="keywordflow">else</span> <a class="code" href="namespacegrepros_1_1common.html#a9bee8d7c9fbeb34db4bd9e2153975d60">drop_zeros</a>(round(c, 9))</div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;        <span class="keywordflow">if</span> f != <span class="stringliteral">&quot;0&quot;</span>: items += [f + n]</div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;    <span class="keywordflow">return</span> <span class="stringliteral">&quot; &quot;</span>.join(items <span class="keywordflow">or</span> [<span class="stringliteral">&quot;0sec&quot;</span>])</div>
<div class="line"><a name="l00642"></a><span class="lineno"><a class="line" href="namespacegrepros_1_1common.html#a1a227cb39eb9a23c864977273f2a3c1b">  642</a></span>&#160; </div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160; </div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;<span class="keyword">def </span><a class="code" href="namespacegrepros_1_1common.html#a19c80f3a78c0a68f7c04def7511a1a0c">format_bytes</a>(size, precision=2, inter=&quot; &quot;, strip=True):</div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;    <span class="stringliteral">&quot;&quot;&quot;Returns a formatted byte size (like 421.40 MB), trailing zeros optionally removed.&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;    result = <span class="stringliteral">&quot;0 bytes&quot;</span></div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;    <span class="keywordflow">if</span> size:</div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;        UNITS = [(<span class="stringliteral">&quot;bytes&quot;</span>, <span class="stringliteral">&quot;byte&quot;</span>)[1 == size]] + [x + <span class="stringliteral">&quot;B&quot;</span> <span class="keywordflow">for</span> x <span class="keywordflow">in</span> <span class="stringliteral">&quot;KMGTPEZY&quot;</span>]</div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;        exponent = min(int(math.log(size, 1024)), len(UNITS) - 1)</div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;        result = <span class="stringliteral">&quot;%.*f&quot;</span> % (precision, size / (1024. ** exponent))</div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;        result += <span class="stringliteral">&quot;&quot;</span> <span class="keywordflow">if</span> precision &gt; 0 <span class="keywordflow">else</span> <span class="stringliteral">&quot;.&quot;</span>  <span class="comment"># Do not strip integer zeroes</span></div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;        result = (<a class="code" href="namespacegrepros_1_1common.html#a9bee8d7c9fbeb34db4bd9e2153975d60">drop_zeros</a>(result) <span class="keywordflow">if</span> strip <span class="keywordflow">else</span> result) + inter + UNITS[exponent]</div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;    <span class="keywordflow">return</span> result</div>
<div class="line"><a name="l00654"></a><span class="lineno"><a class="line" href="namespacegrepros_1_1common.html#a19c80f3a78c0a68f7c04def7511a1a0c">  654</a></span>&#160; </div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160; </div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;<span class="keyword">def </span><a class="code" href="namespacegrepros_1_1common.html#a36a790be13db78554645135b00226dda">format_stamp</a>(stamp):</div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;    <span class="stringliteral">&quot;&quot;&quot;Returns ISO datetime from UNIX timestamp.&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;    <span class="keywordflow">return</span> datetime.datetime.fromtimestamp(stamp).isoformat(sep=<span class="stringliteral">&quot; &quot;</span>)</div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160; </div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160; </div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;<span class="keyword">def </span><a class="code" href="namespacegrepros_1_1common.html#a578d0c22b5ed496b2c6d787b5df848c6">import_item</a>(name):</div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;    <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;<span class="stringliteral">    Returns imported module, or identifier from imported namespace; raises on error.</span></div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;<span class="stringliteral"></span> </div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;<span class="stringliteral">    @param   name  Python module name like &quot;my.module&quot;</span></div>
<div class="line"><a name="l00666"></a><span class="lineno"><a class="line" href="namespacegrepros_1_1common.html#a36a790be13db78554645135b00226dda">  666</a></span>&#160;<span class="stringliteral">                   or module namespace identifier like &quot;my.module.Class&quot;</span></div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;<span class="stringliteral">    &quot;&quot;&quot;</span></div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;    result, parts = <span class="keywordtype">None</span>, name.split(<span class="stringliteral">&quot;.&quot;</span>)</div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;    <span class="keywordflow">for</span> i, item <span class="keywordflow">in</span> enumerate(parts):</div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;        path, success = <span class="stringliteral">&quot;.&quot;</span>.join(parts[:i + 1]), <span class="keyword">False</span></div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;        <span class="keywordflow">try</span>: result, success = importlib.import_module(path), <span class="keyword">True</span></div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;        <span class="keywordflow">except</span> ImportError: <span class="keywordflow">pass</span></div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;        <span class="keywordflow">if</span> <span class="keywordflow">not</span> success <span class="keywordflow">and</span> i:</div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;            <span class="keywordflow">try</span>: result, success = getattr(result, item), <span class="keyword">True</span></div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;            <span class="keywordflow">except</span> AttributeError: <span class="keywordflow">pass</span></div>
<div class="line"><a name="l00676"></a><span class="lineno"><a class="line" href="namespacegrepros_1_1common.html#a578d0c22b5ed496b2c6d787b5df848c6">  676</a></span>&#160;        <span class="keywordflow">if</span> <span class="keywordflow">not</span> success:</div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;            <span class="keywordflow">raise</span> ImportError(<span class="stringliteral">&quot;No module or identifier named %r&quot;</span> % path)</div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;    <span class="keywordflow">return</span> result</div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160; </div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160; </div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;<span class="keyword">def </span><a class="code" href="namespacegrepros_1_1common.html#af7c24279d495dd5ccf14880af3208992">makedirs</a>(path):</div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;    <span class="stringliteral">&quot;&quot;&quot;Creates directory structure for path if not already existing.&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;    parts, accum = list(filter(bool, path.split(os.sep))), []</div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;    <span class="keywordflow">while</span> parts:</div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;        accum.append(parts.pop(0))</div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;        curpath = (os.sep <span class="keywordflow">if</span> path.startswith(os.sep) <span class="keywordflow">else</span> <span class="stringliteral">&quot;&quot;</span>) + os.path.join(*accum)</div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;        <span class="keywordflow">if</span> <span class="keywordflow">not</span> os.path.exists(curpath):</div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;            os.mkdir(curpath)</div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160; </div>
<div class="line"><a name="l00690"></a><span class="lineno"><a class="line" href="namespacegrepros_1_1common.html#af7c24279d495dd5ccf14880af3208992">  690</a></span>&#160; </div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;<span class="keyword">def </span><a class="code" href="namespacegrepros_1_1common.html#a590a3ae1c89cfba64f57683ee79aa51d">memoize</a>(func):</div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;    <span class="stringliteral">&quot;&quot;&quot;Returns a results-caching wrapper for the function.&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;    cache = {}</div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;    <span class="keyword">def </span>inner(*args, **kwargs):</div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;        key = args + sum(kwargs.items(), ())</div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;        <span class="keywordflow">if</span> key <span class="keywordflow">not</span> <span class="keywordflow">in</span> cache:</div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;            cache[key] = func(*args, **kwargs)</div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;        <span class="keywordflow">return</span> cache[key]</div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;    <span class="keywordflow">return</span> functools.update_wrapper(inner, func)</div>
<div class="line"><a name="l00700"></a><span class="lineno"><a class="line" href="namespacegrepros_1_1common.html#a590a3ae1c89cfba64f57683ee79aa51d">  700</a></span>&#160; </div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160; </div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;<span class="keyword">def </span><a class="code" href="namespacegrepros_1_1common.html#ab43190b6708c9ed66ac4ef92f094bf58">merge_dicts</a>(d1, d2):</div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;    <span class="stringliteral">&quot;&quot;&quot;Merges d2 into d1, recursively for nested dicts.&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;    <span class="keywordflow">for</span> k, v <span class="keywordflow">in</span> d2.items():</div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;        <span class="keywordflow">if</span> k <span class="keywordflow">in</span> d1 <span class="keywordflow">and</span> isinstance(v, dict) <span class="keywordflow">and</span> isinstance(d1[k], dict):</div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;            <a class="code" href="namespacegrepros_1_1common.html#ab43190b6708c9ed66ac4ef92f094bf58">merge_dicts</a>(d1[k], v)</div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;        <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;            d1[k] = v</div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160; </div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160; </div>
<div class="line"><a name="l00711"></a><span class="lineno"><a class="line" href="namespacegrepros_1_1common.html#ab43190b6708c9ed66ac4ef92f094bf58">  711</a></span>&#160;<span class="keyword">def </span><a class="code" href="namespacegrepros_1_1common.html#ae7cc809b5dfc4ad10007cc9db5dd0f07">merge_spans</a>(spans):</div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;    <span class="stringliteral">&quot;&quot;&quot;Returns a sorted list of (start, end) spans with overlapping spans merged.&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;    result = sorted(spans)</div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;    result, rest = result[:1], result[1:]</div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;    <span class="keywordflow">for</span> span <span class="keywordflow">in</span> rest:</div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;        <span class="keywordflow">if</span> span[0] &lt;= result[-1][1]:</div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;            result[-1] = (result[-1][0], max(span[1], result[-1][1]))</div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;        <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;            result.append(span)</div>
<div class="line"><a name="l00720"></a><span class="lineno"><a class="line" href="namespacegrepros_1_1common.html#ae7cc809b5dfc4ad10007cc9db5dd0f07">  720</a></span>&#160;    <span class="keywordflow">return</span> result</div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160; </div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160; </div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;<span class="keyword">def </span><a class="code" href="namespacegrepros_1_1common.html#a80ee317da133607a32b69d1c8ab242b3">parse_datetime</a>(text):</div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;    <span class="stringliteral">&quot;&quot;&quot;Returns datetime object from ISO datetime string (may be partial). Raises if invalid.&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;    BASE = re.sub(<span class="stringliteral">r&quot;\D&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, datetime.datetime.min.isoformat())  <span class="comment"># &quot;00010101000000&quot;</span></div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;    text = re.sub(<span class="stringliteral">r&quot;\D&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, text)</div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;    text += BASE[len(text):] <span class="keywordflow">if</span> text <span class="keywordflow">else</span> <span class="stringliteral">&quot;&quot;</span></div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;    dt = datetime.datetime.strptime(text[:len(BASE)], <span class="stringliteral">&quot;%Y%m%d%H%M%S&quot;</span>)</div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;    <span class="keywordflow">return</span> dt + datetime.timedelta(microseconds=int(text[len(BASE):] <span class="keywordflow">or</span> <span class="stringliteral">&quot;0&quot;</span>))</div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160; </div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160; </div>
<div class="line"><a name="l00732"></a><span class="lineno"><a class="line" href="namespacegrepros_1_1common.html#a80ee317da133607a32b69d1c8ab242b3">  732</a></span>&#160;<span class="keyword">def </span><a class="code" href="namespacegrepros_1_1common.html#a2a20fa507eaf87f0a851a43af8a52630">plural</a>(word, items=None, numbers=True, single=&quot;1&quot;, sep=&quot;,&quot;, pref=&quot;&quot;, suf=&quot;&quot;):</div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;    <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;<span class="stringliteral">    Returns the word as &#39;count words&#39;, or &#39;1 word&#39; if count is 1,</span></div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;<span class="stringliteral">    or &#39;words&#39; if count omitted.</span></div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;<span class="stringliteral"></span> </div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;<span class="stringliteral">    @param   items      item collection or count,</span></div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;<span class="stringliteral">                        or None to get just the plural of the word</span></div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;<span class="stringliteral">    @param   numbers    if False, count is omitted from final result</span></div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;<span class="stringliteral">    @param   single     prefix to use for word if count is 1, e.g. &quot;a&quot;</span></div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;<span class="stringliteral">    @param   sep        thousand-separator to use for count</span></div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;<span class="stringliteral">    @param   pref       prefix to prepend to count, e.g. &quot;~150&quot;</span></div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;<span class="stringliteral">    @param   suf        suffix to append to count, e.g. &quot;150+&quot;</span></div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;<span class="stringliteral">    &quot;&quot;&quot;</span></div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;    count   = len(items) <span class="keywordflow">if</span> hasattr(items, <span class="stringliteral">&quot;__len__&quot;</span>) <span class="keywordflow">else</span> items <span class="keywordflow">or</span> 0</div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;    isupper = word[-1:].isupper()</div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;    suffix = <span class="stringliteral">&quot;es&quot;</span> <span class="keywordflow">if</span> word <span class="keywordflow">and</span> word[-1:].lower() <span class="keywordflow">in</span> <span class="stringliteral">&quot;xyz&quot;</span> \</div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;             <span class="keywordflow">and</span> <span class="keywordflow">not</span> word[-2:].lower().endswith(<span class="stringliteral">&quot;ay&quot;</span>) \</div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;             <span class="keywordflow">else</span> <span class="stringliteral">&quot;s&quot;</span> <span class="keywordflow">if</span> word <span class="keywordflow">else</span> <span class="stringliteral">&quot;&quot;</span></div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;    <span class="keywordflow">if</span> isupper: suffix = suffix.upper()</div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;    <span class="keywordflow">if</span> count != 1 <span class="keywordflow">and</span> <span class="stringliteral">&quot;es&quot;</span> == suffix <span class="keywordflow">and</span> <span class="stringliteral">&quot;y&quot;</span> == word[-1:].lower():</div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;        word = word[:-1] + (<span class="stringliteral">&quot;I&quot;</span> <span class="keywordflow">if</span> isupper <span class="keywordflow">else</span> <span class="stringliteral">&quot;i&quot;</span>)</div>
<div class="line"><a name="l00753"></a><span class="lineno"><a class="line" href="namespacegrepros_1_1common.html#a2a20fa507eaf87f0a851a43af8a52630">  753</a></span>&#160;    result = word + (<span class="stringliteral">&quot;&quot;</span> <span class="keywordflow">if</span> 1 == count <span class="keywordflow">else</span> suffix)</div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;    <span class="keywordflow">if</span> numbers <span class="keywordflow">and</span> items <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;        <span class="keywordflow">if</span> 1 == count: fmtcount = single</div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;        <span class="keywordflow">elif</span> <span class="keywordflow">not</span> count: fmtcount = <span class="stringliteral">&quot;0&quot;</span></div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;        <span class="keywordflow">elif</span> sep: fmtcount = <span class="stringliteral">&quot;&quot;</span>.join([</div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;            x + (sep <span class="keywordflow">if</span> i <span class="keywordflow">and</span> <span class="keywordflow">not</span> i % 3 <span class="keywordflow">else</span> <span class="stringliteral">&quot;&quot;</span>) <span class="keywordflow">for</span> i, x <span class="keywordflow">in</span> enumerate(str(count)[::-1])</div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;        ][::-1])</div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;        <span class="keywordflow">else</span>: fmtcount = str(count)</div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160; </div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;        fmtcount = pref + fmtcount + suf</div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;        result = <span class="stringliteral">&quot;%s %s&quot;</span> % (single <span class="keywordflow">if</span> 1 == count <span class="keywordflow">else</span> fmtcount, result)</div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;    <span class="keywordflow">return</span> result.strip()</div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160; </div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160; </div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;<span class="keyword">def </span><a class="code" href="namespacegrepros_1_1common.html#a21047492ab7c4300a1b46dc660aaeefa">unique_path</a>(pathname, empty_ok=False):</div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;    <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;<span class="stringliteral">    Returns a unique version of the path.</span></div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;<span class="stringliteral"></span> </div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;<span class="stringliteral">    If a file or directory with the same name already exists, returns a unique</span></div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;<span class="stringliteral">    version (e.g. &quot;/tmp/my.2.file&quot; if &quot;&quot;/tmp/my.file&quot; already exists).</span></div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;<span class="stringliteral"></span> </div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;<span class="stringliteral">    @param   empty_ok  whether to ignore existence if file is empty</span></div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;<span class="stringliteral">    &quot;&quot;&quot;</span></div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;    result = pathname</div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;    <span class="keywordflow">if</span> <span class="stringliteral">&quot;linux2&quot;</span> == sys.platform <span class="keywordflow">and</span> sys.version_info &lt; (3, 0) \</div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;    <span class="keywordflow">and</span> isinstance(result, unicode) <span class="keywordflow">and</span> <span class="stringliteral">&quot;utf-8&quot;</span> != sys.getfilesystemencoding():</div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;        result = result.encode(<span class="stringliteral">&quot;utf-8&quot;</span>) <span class="comment"># Linux has trouble if locale not UTF-8</span></div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;    <span class="keywordflow">if</span> os.path.isfile(result) <span class="keywordflow">and</span> empty_ok <span class="keywordflow">and</span> <span class="keywordflow">not</span> os.path.getsize(result):</div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;        <span class="keywordflow">return</span> result</div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;    path, name = os.path.split(result)</div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;    base, ext = os.path.splitext(name)</div>
<div class="line"><a name="l00784"></a><span class="lineno"><a class="line" href="namespacegrepros_1_1common.html#a21047492ab7c4300a1b46dc660aaeefa">  784</a></span>&#160;    <span class="keywordflow">if</span> len(name) &gt; 255: <span class="comment"># Filesystem limitation</span></div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;        name = base[:255 - len(ext) - 2] + <span class="stringliteral">&quot;..&quot;</span> + ext</div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;        result = os.path.join(path, name)</div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;    counter = 2</div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;    <span class="keywordflow">while</span> os.path.exists(result):</div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;        suffix = <span class="stringliteral">&quot;.%s%s&quot;</span> % (counter, ext)</div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;        name = base + suffix</div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;        <span class="keywordflow">if</span> len(name) &gt; 255:</div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;            name = base[:255 - len(suffix) - 2] + <span class="stringliteral">&quot;..&quot;</span> + suffix</div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;        result = os.path.join(path, name)</div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;        counter += 1</div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;    <span class="keywordflow">return</span> result</div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160; </div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160; </div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;<span class="keyword">def </span><a class="code" href="namespacegrepros_1_1common.html#a496d7f7b3f426bbb399714a049d49a52">wildcard_to_regex</a>(text, end=False):</div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;    <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;<span class="stringliteral">    Returns plain wildcard like &quot;foo*bar&quot; as re.Pattern(&quot;foo.*bar&quot;, re.I).</span></div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;<span class="stringliteral"></span> </div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;<span class="stringliteral">    @param   end  whether pattern should match until end (adds $)</span></div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;<span class="stringliteral">    &quot;&quot;&quot;</span></div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;    suff = <span class="stringliteral">&quot;$&quot;</span> <span class="keywordflow">if</span> end <span class="keywordflow">else</span> <span class="stringliteral">&quot;&quot;</span></div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;    <span class="keywordflow">return</span> re.compile(<span class="stringliteral">&quot;.*&quot;</span>.join(map(re.escape, text.split(<span class="stringliteral">&quot;*&quot;</span>))) + suff, re.I)</div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<div class="ttc" id="aclassgrepros_1_1common_1_1_text_wrapper_html_a167f3d1d219cdeb0285ec26cc28c2275"><div class="ttname"><a href="classgrepros_1_1common_1_1_text_wrapper.html#a167f3d1d219cdeb0285ec26cc28c2275">grepros.common.TextWrapper.disabled</a></div><div class="ttdeci">disabled</div><div class="ttdef"><b>Definition:</b> <a href="common_8py_source.html#l00396">common.py:396</a></div></div>
<div class="ttc" id="aclassgrepros_1_1common_1_1_progress_bar_html_afd7d49e17b69bd6bf3d7a649856c1067"><div class="ttname"><a href="classgrepros_1_1common_1_1_progress_bar.html#afd7d49e17b69bd6bf3d7a649856c1067">grepros.common.ProgressBar.pause</a></div><div class="ttdeci">pause</div><div class="ttdef"><b>Definition:</b> <a href="common_8py_source.html#l00276">common.py:276</a></div></div>
<div class="ttc" id="aclassgrepros_1_1common_1_1_text_wrapper_html_a0ad5c469cfa34f578ef4fe584e84a8c7"><div class="ttname"><a href="classgrepros_1_1common_1_1_text_wrapper.html#a0ad5c469cfa34f578ef4fe584e84a8c7">grepros.common.TextWrapper._handle_long_word</a></div><div class="ttdeci">def _handle_long_word(self, reversed_chunks, cur_line, cur_len, width)</div><div class="ttdoc">Breaks last chunk if not only containing a custom-width string, else adds last chunk to current line ...</div><div class="ttdef"><b>Definition:</b> <a href="common_8py_source.html#l00509">common.py:509</a></div></div>
<div class="ttc" id="aclassgrepros_1_1common_1_1_text_wrapper_html_a2354be14036ab63e94d74cd4f5ba1959"><div class="ttname"><a href="classgrepros_1_1common_1_1_text_wrapper.html#a2354be14036ab63e94d74cd4f5ba1959">grepros.common.TextWrapper.strip</a></div><div class="ttdeci">def strip(self, v)</div><div class="ttdoc">Returns string with custom substrings and whitespace stripped.</div><div class="ttdef"><b>Definition:</b> <a href="common_8py_source.html#l00438">common.py:438</a></div></div>
<div class="ttc" id="aclassgrepros_1_1common_1_1_progress_bar_html_a5426824942db4253f87a1009fd5d2d4f"><div class="ttname"><a href="classgrepros_1_1common_1_1_progress_bar.html#a5426824942db4253f87a1009fd5d2d4f">grepros.common.ProgressBar.bar</a></div><div class="ttdeci">bar</div><div class="ttdef"><b>Definition:</b> <a href="common_8py_source.html#l00278">common.py:278</a></div></div>
<div class="ttc" id="aclassgrepros_1_1common_1_1_console_printer_html_a31f4aa0ec2886058132efc52572bace5"><div class="ttname"><a href="classgrepros_1_1common_1_1_console_printer.html#a31f4aa0ec2886058132efc52572bace5">grepros.common.ConsolePrinter.warn</a></div><div class="ttdeci">def warn(cls, text=&quot;&quot;, *args, **kwargs)</div><div class="ttdoc">Prints warning to stderr.</div><div class="ttdef"><b>Definition:</b> <a href="common_8py_source.html#l00151">common.py:151</a></div></div>
<div class="ttc" id="anamespacegrepros_1_1common_html_ae7cc809b5dfc4ad10007cc9db5dd0f07"><div class="ttname"><a href="namespacegrepros_1_1common.html#ae7cc809b5dfc4ad10007cc9db5dd0f07">grepros.common.merge_spans</a></div><div class="ttdeci">def merge_spans(spans)</div><div class="ttdoc">Returns a sorted list of (start, end) spans with overlapping spans merged.</div><div class="ttdef"><b>Definition:</b> <a href="common_8py_source.html#l00720">common.py:720</a></div></div>
<div class="ttc" id="aclassgrepros_1_1common_1_1_progress_bar_html_aa7920418e8e7f7c4add4028cb48aab3f"><div class="ttname"><a href="classgrepros_1_1common_1_1_progress_bar.html#aa7920418e8e7f7c4add4028cb48aab3f">grepros.common.ProgressBar.draw</a></div><div class="ttdeci">def draw(self, flush=False)</div><div class="ttdoc">Prints the progress bar, from the beginning of the current line.</div><div class="ttdef"><b>Definition:</b> <a href="common_8py_source.html#l00339">common.py:339</a></div></div>
<div class="ttc" id="aclassgrepros_1_1common_1_1_decompressor_html_a389efe91f5934c31d830e1352b5f9c6d"><div class="ttname"><a href="classgrepros_1_1common_1_1_decompressor.html#a389efe91f5934c31d830e1352b5f9c6d">grepros.common.Decompressor.validate</a></div><div class="ttdeci">def validate(cls)</div><div class="ttdoc">Raises error if decompression library not available.</div><div class="ttdef"><b>Definition:</b> <a href="common_8py_source.html#l00237">common.py:237</a></div></div>
<div class="ttc" id="aclassgrepros_1_1common_1_1_console_printer_html_a58615d20b29afc34a4bd73de20c61854"><div class="ttname"><a href="classgrepros_1_1common_1_1_console_printer.html#a58615d20b29afc34a4bd73de20c61854">grepros.common.ConsolePrinter._LINEOPEN</a></div><div class="ttdeci">bool _LINEOPEN</div><div class="ttdef"><b>Definition:</b> <a href="common_8py_source.html#l00070">common.py:70</a></div></div>
<div class="ttc" id="aclassgrepros_1_1common_1_1_console_printer_html_a59c3bba4b17cd5e19f149ea175fa6989"><div class="ttname"><a href="classgrepros_1_1common_1_1_console_printer.html#a59c3bba4b17cd5e19f149ea175fa6989">grepros.common.ConsolePrinter.WIDTH</a></div><div class="ttdeci">int WIDTH</div><div class="ttdef"><b>Definition:</b> <a href="common_8py_source.html#l00063">common.py:63</a></div></div>
<div class="ttc" id="aclassgrepros_1_1common_1_1_progress_bar_html_acd1b00228d32592329c086639774536e"><div class="ttname"><a href="classgrepros_1_1common_1_1_progress_bar.html#acd1b00228d32592329c086639774536e">grepros.common.ProgressBar.update</a></div><div class="ttdeci">def update(self, value=None, draw=True, flush=False)</div><div class="ttdoc">Updates the progress bar value, and refreshes by default; returns self.</div><div class="ttdef"><b>Definition:</b> <a href="common_8py_source.html#l00289">common.py:289</a></div></div>
<div class="ttc" id="aclassgrepros_1_1common_1_1_progress_bar_html_a4299f0f984e2afbd4fcd4db6c744fdb5"><div class="ttname"><a href="classgrepros_1_1common_1_1_progress_bar.html#a4299f0f984e2afbd4fcd4db6c744fdb5">grepros.common.ProgressBar.progresschar</a></div><div class="ttdeci">progresschar</div><div class="ttdef"><b>Definition:</b> <a href="common_8py_source.html#l00283">common.py:283</a></div></div>
<div class="ttc" id="aclassgrepros_1_1common_1_1_text_wrapper_html_a6513377ac92c85d46df28191e8b123b6"><div class="ttname"><a href="classgrepros_1_1common_1_1_text_wrapper.html#a6513377ac92c85d46df28191e8b123b6">grepros.common.TextWrapper.subsequent_indent</a></div><div class="ttdeci">subsequent_indent</div><div class="ttdef"><b>Definition:</b> <a href="common_8py_source.html#l00386">common.py:386</a></div></div>
<div class="ttc" id="aclassgrepros_1_1common_1_1_decompressor_html_ad2788c37d3aed499aa410f6d17e2f4b9"><div class="ttname"><a href="classgrepros_1_1common_1_1_decompressor.html#ad2788c37d3aed499aa410f6d17e2f4b9">grepros.common.Decompressor.EXTENSIONS</a></div><div class="ttdeci">tuple EXTENSIONS</div><div class="ttdoc">Supported archive extensions.</div><div class="ttdef"><b>Definition:</b> <a href="common_8py_source.html#l00178">common.py:178</a></div></div>
<div class="ttc" id="aclassgrepros_1_1common_1_1_text_wrapper_html_ae02c47a0db2c25ceda38c474a35398a6"><div class="ttname"><a href="classgrepros_1_1common_1_1_text_wrapper.html#ae02c47a0db2c25ceda38c474a35398a6">grepros.common.TextWrapper.reserve_width</a></div><div class="ttdeci">def reserve_width(self, reserved=&quot;&quot;)</div><div class="ttdoc">Decreases the configured width by given amount (number or string).</div><div class="ttdef"><b>Definition:</b> <a href="common_8py_source.html#l00425">common.py:425</a></div></div>
<div class="ttc" id="aclassgrepros_1_1common_1_1_progress_bar_html_a9c17a624c873883e9fccc9debdb1c10f"><div class="ttname"><a href="classgrepros_1_1common_1_1_progress_bar.html#a9c17a624c873883e9fccc9debdb1c10f">grepros.common.ProgressBar.pulse_pos</a></div><div class="ttdeci">pulse_pos</div><div class="ttdef"><b>Definition:</b> <a href="common_8py_source.html#l00277">common.py:277</a></div></div>
<div class="ttc" id="anamespacegrepros_1_1common_html_a9bee8d7c9fbeb34db4bd9e2153975d60"><div class="ttname"><a href="namespacegrepros_1_1common.html#a9bee8d7c9fbeb34db4bd9e2153975d60">grepros.common.drop_zeros</a></div><div class="ttdeci">def drop_zeros(v, replace=&quot;&quot;)</div><div class="ttdoc">Drops or replaces trailing zeros and empty decimal separator, if any.</div><div class="ttdef"><b>Definition:</b> <a href="common_8py_source.html#l00528">common.py:528</a></div></div>
<div class="ttc" id="aclassgrepros_1_1common_1_1_progress_bar_html_afcc7a4b78ecd8fa7e713f8cfa0f51017"><div class="ttname"><a href="classgrepros_1_1common_1_1_progress_bar.html#afcc7a4b78ecd8fa7e713f8cfa0f51017">grepros.common.ProgressBar.value</a></div><div class="ttdeci">value</div><div class="ttdef"><b>Definition:</b> <a href="common_8py_source.html#l00275">common.py:275</a></div></div>
<div class="ttc" id="anamespacegrepros_1_1common_html_a19c80f3a78c0a68f7c04def7511a1a0c"><div class="ttname"><a href="namespacegrepros_1_1common.html#a19c80f3a78c0a68f7c04def7511a1a0c">grepros.common.format_bytes</a></div><div class="ttdeci">def format_bytes(size, precision=2, inter=&quot; &quot;, strip=True)</div><div class="ttdoc">Returns a formatted byte size (like 421.40 MB), trailing zeros optionally removed.</div><div class="ttdef"><b>Definition:</b> <a href="common_8py_source.html#l00654">common.py:654</a></div></div>
<div class="ttc" id="aclassgrepros_1_1common_1_1_progress_bar_html_ae2dc0f1c541d7886d07e3e3d7f11b643"><div class="ttname"><a href="classgrepros_1_1common_1_1_progress_bar.html#ae2dc0f1c541d7886d07e3e3d7f11b643">grepros.common.ProgressBar.is_running</a></div><div class="ttdeci">is_running</div><div class="ttdef"><b>Definition:</b> <a href="common_8py_source.html#l00284">common.py:284</a></div></div>
<div class="ttc" id="aclassgrepros_1_1common_1_1_decompressor_html_a69348d5743a47cc864a5ea5a93349d63"><div class="ttname"><a href="classgrepros_1_1common_1_1_decompressor.html#a69348d5743a47cc864a5ea5a93349d63">grepros.common.Decompressor.ZSTD_MAGIC</a></div><div class="ttdeci">string ZSTD_MAGIC</div><div class="ttdoc">zstd file header magic start bytes</div><div class="ttdef"><b>Definition:</b> <a href="common_8py_source.html#l00181">common.py:181</a></div></div>
<div class="ttc" id="aclassgrepros_1_1common_1_1_text_wrapper_html_a74302178e52e1de799f3424ebe2a6d82"><div class="ttname"><a href="classgrepros_1_1common_1_1_text_wrapper.html#a74302178e52e1de799f3424ebe2a6d82">grepros.common.TextWrapper.LENCACHEMAX</a></div><div class="ttdeci">int LENCACHEMAX</div><div class="ttdoc">Max length of strlen cache.</div><div class="ttdef"><b>Definition:</b> <a href="common_8py_source.html#l00371">common.py:371</a></div></div>
<div class="ttc" id="aclassgrepros_1_1common_1_1_console_printer_html"><div class="ttname"><a href="classgrepros_1_1common_1_1_console_printer.html">grepros.common.ConsolePrinter</a></div><div class="ttdoc">Prints to console, supports color output.</div><div class="ttdef"><b>Definition:</b> <a href="common_8py_source.html#l00046">common.py:46</a></div></div>
<div class="ttc" id="anamespacegrepros_1_1common_html_a496d7f7b3f426bbb399714a049d49a52"><div class="ttname"><a href="namespacegrepros_1_1common.html#a496d7f7b3f426bbb399714a049d49a52">grepros.common.wildcard_to_regex</a></div><div class="ttdeci">def wildcard_to_regex(text, end=False)</div><div class="ttdoc">Returns plain wildcard like &quot;foo*bar&quot; as re.Pattern(&quot;foo.*bar&quot;, re.I).</div><div class="ttdef"><b>Definition:</b> <a href="common_8py_source.html#l00812">common.py:812</a></div></div>
<div class="ttc" id="aclassgrepros_1_1common_1_1_console_printer_html_aeffdcb40de1409c8869d68032c86b904"><div class="ttname"><a href="classgrepros_1_1common_1_1_console_printer.html#aeffdcb40de1409c8869d68032c86b904">grepros.common.ConsolePrinter.ERROR_END</a></div><div class="ttdeci">ERROR_END</div><div class="ttdef"><b>Definition:</b> <a href="common_8py_source.html#l00059">common.py:59</a></div></div>
<div class="ttc" id="anamespacegrepros_1_1common_html_a36a790be13db78554645135b00226dda"><div class="ttname"><a href="namespacegrepros_1_1common.html#a36a790be13db78554645135b00226dda">grepros.common.format_stamp</a></div><div class="ttdeci">def format_stamp(stamp)</div><div class="ttdoc">Returns ISO datetime from UNIX timestamp.</div><div class="ttdef"><b>Definition:</b> <a href="common_8py_source.html#l00666">common.py:666</a></div></div>
<div class="ttc" id="aclassgrepros_1_1common_1_1_text_wrapper_html_a9e28a1714da334e04573f51ae2bbd8bb"><div class="ttname"><a href="classgrepros_1_1common_1_1_text_wrapper.html#a9e28a1714da334e04573f51ae2bbd8bb">grepros.common.TextWrapper.max_lines</a></div><div class="ttdeci">max_lines</div><div class="ttdef"><b>Definition:</b> <a href="common_8py_source.html#l00389">common.py:389</a></div></div>
<div class="ttc" id="aclassgrepros_1_1common_1_1_progress_bar_html_a1702ac8242f004352282d0e43bcedaea"><div class="ttname"><a href="classgrepros_1_1common_1_1_progress_bar.html#a1702ac8242f004352282d0e43bcedaea">grepros.common.ProgressBar.printbar</a></div><div class="ttdeci">printbar</div><div class="ttdef"><b>Definition:</b> <a href="common_8py_source.html#l00282">common.py:282</a></div></div>
<div class="ttc" id="aclassgrepros_1_1common_1_1_console_printer_html_a6e3d360b6df97f2cfc3d52a67d92d44d"><div class="ttname"><a href="classgrepros_1_1common_1_1_console_printer.html#a6e3d360b6df97f2cfc3d52a67d92d44d">grepros.common.ConsolePrinter.STYLE_ERROR</a></div><div class="ttdeci">string STYLE_ERROR</div><div class="ttdef"><b>Definition:</b> <a href="common_8py_source.html#l00055">common.py:55</a></div></div>
<div class="ttc" id="aclassgrepros_1_1common_1_1_console_printer_html_af90824509586333cf45ce757d2711ce3"><div class="ttname"><a href="classgrepros_1_1common_1_1_console_printer.html#af90824509586333cf45ce757d2711ce3">grepros.common.ConsolePrinter.COLOR</a></div><div class="ttdeci">COLOR</div><div class="ttdoc">Error message wrappers.</div><div class="ttdef"><b>Definition:</b> <a href="common_8py_source.html#l00061">common.py:61</a></div></div>
<div class="ttc" id="aclassgrepros_1_1common_1_1_text_wrapper_html_ab73271f70effbb97663154a50a24ff00"><div class="ttname"><a href="classgrepros_1_1common_1_1_text_wrapper.html#ab73271f70effbb97663154a50a24ff00">grepros.common.TextWrapper.placeholder</a></div><div class="ttdeci">placeholder</div><div class="ttdef"><b>Definition:</b> <a href="common_8py_source.html#l00390">common.py:390</a></div></div>
<div class="ttc" id="aclassgrepros_1_1common_1_1_console_printer_html_a3936bf6da60f41002f1c863aeb598805"><div class="ttname"><a href="classgrepros_1_1common_1_1_console_printer.html#a3936bf6da60f41002f1c863aeb598805">grepros.common.ConsolePrinter._UNIQUES</a></div><div class="ttdeci">_UNIQUES</div><div class="ttdef"><b>Definition:</b> <a href="common_8py_source.html#l00075">common.py:75</a></div></div>
<div class="ttc" id="anamespacegrepros_1_1common_html_acf36aeb58c7754bfe76d3e0f36003584"><div class="ttname"><a href="namespacegrepros_1_1common.html#acf36aeb58c7754bfe76d3e0f36003584">grepros.common.ellipsize</a></div><div class="ttdeci">def ellipsize(text, limit, ellipsis=&quot;..&quot;)</div><div class="ttdoc">Returns text ellipsized if beyond limit.</div><div class="ttdef"><b>Definition:</b> <a href="common_8py_source.html#l00533">common.py:533</a></div></div>
<div class="ttc" id="aclassgrepros_1_1common_1_1_console_printer_html_ac6698ed375a764f7491334e3e98fa234"><div class="ttname"><a href="classgrepros_1_1common_1_1_console_printer.html#ac6698ed375a764f7491334e3e98fa234">grepros.common.ConsolePrinter.configure</a></div><div class="ttdeci">def configure(cls, color)</div><div class="ttdoc">Initializes terminal for color output, or disables color output if unsupported.</div><div class="ttdef"><b>Definition:</b> <a href="common_8py_source.html#l00083">common.py:83</a></div></div>
<div class="ttc" id="aclassgrepros_1_1common_1_1_progress_bar_html_a56336262068f0a007b1dec71901be1ff"><div class="ttname"><a href="classgrepros_1_1common_1_1_progress_bar.html#a56336262068f0a007b1dec71901be1ff">grepros.common.ProgressBar.daemon</a></div><div class="ttdeci">daemon</div><div class="ttdef"><b>Definition:</b> <a href="common_8py_source.html#l00273">common.py:273</a></div></div>
<div class="ttc" id="aclassgrepros_1_1common_1_1_console_printer_html_adc19d62887c9c40b9b1bb8b8d93d5ed0"><div class="ttname"><a href="classgrepros_1_1common_1_1_console_printer.html#adc19d62887c9c40b9b1bb8b8d93d5ed0">grepros.common.ConsolePrinter.STYLE_RESET</a></div><div class="ttdeci">string STYLE_RESET</div><div class="ttdef"><b>Definition:</b> <a href="common_8py_source.html#l00049">common.py:49</a></div></div>
<div class="ttc" id="aclassgrepros_1_1common_1_1_text_wrapper_html_a84685ed0862a8dcda5f320f131464797"><div class="ttname"><a href="classgrepros_1_1common_1_1_text_wrapper.html#a84685ed0862a8dcda5f320f131464797">grepros.common.TextWrapper.minwidth</a></div><div class="ttdeci">minwidth</div><div class="ttdef"><b>Definition:</b> <a href="common_8py_source.html#l00397">common.py:397</a></div></div>
<div class="ttc" id="aclassgrepros_1_1common_1_1_text_wrapper_html_a815024d0c2db3754f20d8f1caebb45df"><div class="ttname"><a href="classgrepros_1_1common_1_1_text_wrapper.html#a815024d0c2db3754f20d8f1caebb45df">grepros.common.TextWrapper.custom_rgx</a></div><div class="ttdeci">custom_rgx</div><div class="ttdef"><b>Definition:</b> <a href="common_8py_source.html#l00395">common.py:395</a></div></div>
<div class="ttc" id="aclassgrepros_1_1common_1_1_text_wrapper_html_aa6a15ee24d54eae658b86b0257188f91"><div class="ttname"><a href="classgrepros_1_1common_1_1_text_wrapper.html#aa6a15ee24d54eae658b86b0257188f91">grepros.common.TextWrapper.custom_lens</a></div><div class="ttdeci">custom_lens</div><div class="ttdef"><b>Definition:</b> <a href="common_8py_source.html#l00394">common.py:394</a></div></div>
<div class="ttc" id="aclassgrepros_1_1common_1_1_text_wrapper_html_a081090be3d428541490bb48323877653"><div class="ttname"><a href="classgrepros_1_1common_1_1_text_wrapper.html#a081090be3d428541490bb48323877653">grepros.common.TextWrapper.realwidth</a></div><div class="ttdeci">realwidth</div><div class="ttdef"><b>Definition:</b> <a href="common_8py_source.html#l00400">common.py:400</a></div></div>
<div class="ttc" id="aclassgrepros_1_1common_1_1_text_wrapper_html_a3f0d44e708e1dd2905c55926eb782465"><div class="ttname"><a href="classgrepros_1_1common_1_1_text_wrapper.html#a3f0d44e708e1dd2905c55926eb782465">grepros.common.TextWrapper.break_long_words</a></div><div class="ttdeci">break_long_words</div><div class="ttdef"><b>Definition:</b> <a href="common_8py_source.html#l00387">common.py:387</a></div></div>
<div class="ttc" id="aclass_exception_html"><div class="ttname"><a href="class_exception.html">Exception</a></div></div>
<div class="ttc" id="aclassgrepros_1_1common_1_1_progress_bar_html_ad22709b2e67308af35f55680d5a026e0"><div class="ttname"><a href="classgrepros_1_1common_1_1_progress_bar.html#ad22709b2e67308af35f55680d5a026e0">grepros.common.ProgressBar.run</a></div><div class="ttdeci">def run(self)</div><div class="ttdef"><b>Definition:</b> <a href="common_8py_source.html#l00347">common.py:347</a></div></div>
<div class="ttc" id="aclassgrepros_1_1common_1_1_console_printer_html_a21ead9564c18f7a6afd439a5660e0526"><div class="ttname"><a href="classgrepros_1_1common_1_1_console_printer.html#a21ead9564c18f7a6afd439a5660e0526">grepros.common.ConsolePrinter.WARN_START</a></div><div class="ttdeci">WARN_START</div><div class="ttdoc">Metainfo wrappers.</div><div class="ttdef"><b>Definition:</b> <a href="common_8py_source.html#l00058">common.py:58</a></div></div>
<div class="ttc" id="anamespacegrepros_1_1common_html_af1be1d815c8bf65b1d8c4b6c1b2f5130"><div class="ttname"><a href="namespacegrepros_1_1common.html#af1be1d815c8bf65b1d8c4b6c1b2f5130">grepros.common.find_files</a></div><div class="ttdeci">def find_files(names=(), paths=(), extensions=(), skip_extensions=(), recurse=False)</div><div class="ttdoc">Yields filenames from current directory or given paths, .</div><div class="ttdef"><b>Definition:</b> <a href="common_8py_source.html#l00602">common.py:602</a></div></div>
<div class="ttc" id="aclassgrepros_1_1common_1_1_text_wrapper_html"><div class="ttname"><a href="classgrepros_1_1common_1_1_text_wrapper.html">grepros.common.TextWrapper</a></div><div class="ttdoc">TextWrapper that supports custom substring widths in line width calculation.</div><div class="ttdef"><b>Definition:</b> <a href="common_8py_source.html#l00365">common.py:365</a></div></div>
<div class="ttc" id="aclassgrepros_1_1common_1_1_text_wrapper_html_ae79644dfff8aaf480fb1c314b52d48b4"><div class="ttname"><a href="classgrepros_1_1common_1_1_text_wrapper.html#ae79644dfff8aaf480fb1c314b52d48b4">grepros.common.TextWrapper.wrap</a></div><div class="ttdeci">def wrap(self, text)</div><div class="ttdoc">Returns a list of wrapped text lines, without linebreaks.</div><div class="ttdef"><b>Definition:</b> <a href="common_8py_source.html#l00404">common.py:404</a></div></div>
<div class="ttc" id="aclassgrepros_1_1common_1_1_progress_bar_html_a26ca7c1c7fcdd35378e7be97727047a6"><div class="ttname"><a href="classgrepros_1_1common_1_1_progress_bar.html#a26ca7c1c7fcdd35378e7be97727047a6">grepros.common.ProgressBar.stop</a></div><div class="ttdeci">def stop(self)</div><div class="ttdef"><b>Definition:</b> <a href="common_8py_source.html#l00354">common.py:354</a></div></div>
<div class="ttc" id="anamespacegrepros_1_1common_html_a21047492ab7c4300a1b46dc660aaeefa"><div class="ttname"><a href="namespacegrepros_1_1common.html#a21047492ab7c4300a1b46dc660aaeefa">grepros.common.unique_path</a></div><div class="ttdeci">def unique_path(pathname, empty_ok=False)</div><div class="ttdoc">Returns a unique version of the path.</div><div class="ttdef"><b>Definition:</b> <a href="common_8py_source.html#l00784">common.py:784</a></div></div>
<div class="ttc" id="anamespacegrepros_1_1common_html_a590a3ae1c89cfba64f57683ee79aa51d"><div class="ttname"><a href="namespacegrepros_1_1common.html#a590a3ae1c89cfba64f57683ee79aa51d">grepros.common.memoize</a></div><div class="ttdeci">def memoize(func)</div><div class="ttdoc">Returns a results-caching wrapper for the function.</div><div class="ttdef"><b>Definition:</b> <a href="common_8py_source.html#l00700">common.py:700</a></div></div>
<div class="ttc" id="anamespacegrepros_1_1common_html_a80ee317da133607a32b69d1c8ab242b3"><div class="ttname"><a href="namespacegrepros_1_1common.html#a80ee317da133607a32b69d1c8ab242b3">grepros.common.parse_datetime</a></div><div class="ttdeci">def parse_datetime(text)</div><div class="ttdoc">Returns datetime object from ISO datetime string (may be partial).</div><div class="ttdef"><b>Definition:</b> <a href="common_8py_source.html#l00732">common.py:732</a></div></div>
<div class="ttc" id="aclassgrepros_1_1common_1_1_text_wrapper_html_aa2946015d9dc1b24300f7bb0439c6adc"><div class="ttname"><a href="classgrepros_1_1common_1_1_text_wrapper.html#aa2946015d9dc1b24300f7bb0439c6adc">grepros.common.TextWrapper.__init__</a></div><div class="ttdeci">def __init__(self, width=80, subsequent_indent=&quot;  &quot;, break_long_words=True, drop_whitespace=False, max_lines=None, placeholder=&quot; ...&quot;, custom_widths=None)</div><div class="ttdef"><b>Definition:</b> <a href="common_8py_source.html#l00384">common.py:384</a></div></div>
<div class="ttc" id="aclassgrepros_1_1common_1_1_match_markers_html"><div class="ttname"><a href="classgrepros_1_1common_1_1_match_markers.html">grepros.common.MatchMarkers</a></div><div class="ttdoc">Highlight markers for matches in message values.</div><div class="ttdef"><b>Definition:</b> <a href="common_8py_source.html#l00036">common.py:36</a></div></div>
<div class="ttc" id="anamespacegrepros_1_1common_html_a2a20fa507eaf87f0a851a43af8a52630"><div class="ttname"><a href="namespacegrepros_1_1common.html#a2a20fa507eaf87f0a851a43af8a52630">grepros.common.plural</a></div><div class="ttdeci">def plural(word, items=None, numbers=True, single=&quot;1&quot;, sep=&quot;,&quot;, pref=&quot;&quot;, suf=&quot;&quot;)</div><div class="ttdoc">Returns the word as 'count words', or '1 word' if count is 1, or 'words' if count omitted.</div><div class="ttdef"><b>Definition:</b> <a href="common_8py_source.html#l00753">common.py:753</a></div></div>
<div class="ttc" id="aclassgrepros_1_1common_1_1_console_printer_html_af2fc71ba34022b648d81ca257899058a"><div class="ttname"><a href="classgrepros_1_1common_1_1_console_printer.html#af2fc71ba34022b648d81ca257899058a">grepros.common.ConsolePrinter.STYLE_WARN</a></div><div class="ttdeci">string STYLE_WARN</div><div class="ttdef"><b>Definition:</b> <a href="common_8py_source.html#l00054">common.py:54</a></div></div>
<div class="ttc" id="anamespacegrepros_1_1common_html_af7c24279d495dd5ccf14880af3208992"><div class="ttname"><a href="namespacegrepros_1_1common.html#af7c24279d495dd5ccf14880af3208992">grepros.common.makedirs</a></div><div class="ttdeci">def makedirs(path)</div><div class="ttdoc">Creates directory structure for path if not already existing.</div><div class="ttdef"><b>Definition:</b> <a href="common_8py_source.html#l00690">common.py:690</a></div></div>
<div class="ttc" id="anamespacegrepros_1_1common_html_a8e02f5d98e712b40b989993d1820be89"><div class="ttname"><a href="namespacegrepros_1_1common.html#a8e02f5d98e712b40b989993d1820be89">grepros.common.filter_dict</a></div><div class="ttdeci">def filter_dict(dct, keys=(), values=(), reverse=False)</div><div class="ttdoc">Filters string dictionary by keys and values.</div><div class="ttdef"><b>Definition:</b> <a href="common_8py_source.html#l00547">common.py:547</a></div></div>
<div class="ttc" id="anamespacegrepros_1_1common_html_a1a227cb39eb9a23c864977273f2a3c1b"><div class="ttname"><a href="namespacegrepros_1_1common.html#a1a227cb39eb9a23c864977273f2a3c1b">grepros.common.format_timedelta</a></div><div class="ttdeci">def format_timedelta(delta)</div><div class="ttdoc">Formats the datetime.timedelta as &quot;3d 40h 23min 23.1sec&quot;.</div><div class="ttdef"><b>Definition:</b> <a href="common_8py_source.html#l00642">common.py:642</a></div></div>
<div class="ttc" id="aclassgrepros_1_1common_1_1_console_printer_html_adadd930a96f7396162da394dd8c0afe5"><div class="ttname"><a href="classgrepros_1_1common_1_1_console_printer.html#adadd930a96f7396162da394dd8c0afe5">grepros.common.ConsolePrinter.ERROR_START</a></div><div class="ttdeci">ERROR_START</div><div class="ttdoc">Warning message wrappers.</div><div class="ttdef"><b>Definition:</b> <a href="common_8py_source.html#l00059">common.py:59</a></div></div>
<div class="ttc" id="aclassgrepros_1_1common_1_1_text_wrapper_html_a5558ace5433f9aabbf0a0ec059900d94"><div class="ttname"><a href="classgrepros_1_1common_1_1_text_wrapper.html#a5558ace5433f9aabbf0a0ec059900d94">grepros.common.TextWrapper.width</a></div><div class="ttdeci">width</div><div class="ttdef"><b>Definition:</b> <a href="common_8py_source.html#l00385">common.py:385</a></div></div>
<div class="ttc" id="aclassgrepros_1_1common_1_1_decompressor_html"><div class="ttname"><a href="classgrepros_1_1common_1_1_decompressor.html">grepros.common.Decompressor</a></div><div class="ttdoc">Decompresses zstandard archives.</div><div class="ttdef"><b>Definition:</b> <a href="common_8py_source.html#l00174">common.py:174</a></div></div>
<div class="ttc" id="aclassgrepros_1_1common_1_1_console_printer_html_a471aca6fad4c414e644c86e5621627a5"><div class="ttname"><a href="classgrepros_1_1common_1_1_console_printer.html#a471aca6fad4c414e644c86e5621627a5">grepros.common.ConsolePrinter.debug</a></div><div class="ttdeci">def debug(cls, text=&quot;&quot;, *args, **kwargs)</div><div class="ttdoc">Prints debug text to stderr.</div><div class="ttdef"><b>Definition:</b> <a href="common_8py_source.html#l00162">common.py:162</a></div></div>
<div class="ttc" id="aclassgrepros_1_1common_1_1_console_printer_html_aacebe601cd2ff73384e4c4cac54de357"><div class="ttname"><a href="classgrepros_1_1common_1_1_console_printer.html#aacebe601cd2ff73384e4c4cac54de357">grepros.common.ConsolePrinter.PRINTS</a></div><div class="ttdeci">dictionary PRINTS</div><div class="ttdef"><b>Definition:</b> <a href="common_8py_source.html#l00065">common.py:65</a></div></div>
<div class="ttc" id="aclassgrepros_1_1common_1_1_progress_bar_html_a174e692bc1b62677e7b4d611ed06b109"><div class="ttname"><a href="classgrepros_1_1common_1_1_progress_bar.html#a174e692bc1b62677e7b4d611ed06b109">grepros.common.ProgressBar.percent</a></div><div class="ttdeci">percent</div><div class="ttdef"><b>Definition:</b> <a href="common_8py_source.html#l00274">common.py:274</a></div></div>
<div class="ttc" id="aclassgrepros_1_1common_1_1_console_printer_html_a6c15f9df497ebfefadc582fd19f64a85"><div class="ttname"><a href="classgrepros_1_1common_1_1_console_printer.html#a6c15f9df497ebfefadc582fd19f64a85">grepros.common.ConsolePrinter.STYLE_LOWLIGHT</a></div><div class="ttdeci">string STYLE_LOWLIGHT</div><div class="ttdef"><b>Definition:</b> <a href="common_8py_source.html#l00051">common.py:51</a></div></div>
<div class="ttc" id="aclassgrepros_1_1common_1_1_console_printer_html_a9bd93596caa75c86e7fa423f02ab1a6c"><div class="ttname"><a href="classgrepros_1_1common_1_1_console_printer.html#a9bd93596caa75c86e7fa423f02ab1a6c">grepros.common.ConsolePrinter.DEBUG_START</a></div><div class="ttdeci">DEBUG_START</div><div class="ttdef"><b>Definition:</b> <a href="common_8py_source.html#l00057">common.py:57</a></div></div>
<div class="ttc" id="aclassgrepros_1_1common_1_1_decompressor_html_a076bb39cd43c5e24718d58cfef776520"><div class="ttname"><a href="classgrepros_1_1common_1_1_decompressor.html#a076bb39cd43c5e24718d58cfef776520">grepros.common.Decompressor.is_compressed</a></div><div class="ttdeci">def is_compressed(cls, path)</div><div class="ttdoc">Returns whether file is a recognized archive.</div><div class="ttdef"><b>Definition:</b> <a href="common_8py_source.html#l00219">common.py:219</a></div></div>
<div class="ttc" id="aclassgrepros_1_1common_1_1_console_printer_html_a70034fa7a4a0f7912242988a590a85cb"><div class="ttname"><a href="classgrepros_1_1common_1_1_console_printer.html#a70034fa7a4a0f7912242988a590a85cb">grepros.common.ConsolePrinter.DEBUG_END</a></div><div class="ttdeci">DEBUG_END</div><div class="ttdef"><b>Definition:</b> <a href="common_8py_source.html#l00057">common.py:57</a></div></div>
<div class="ttc" id="aclassgrepros_1_1common_1_1_text_wrapper_html_ad9fa472611d581ffb1d3dd22f0f9c7ff"><div class="ttname"><a href="classgrepros_1_1common_1_1_text_wrapper.html#ad9fa472611d581ffb1d3dd22f0f9c7ff">grepros.common.TextWrapper.SPACE_RGX</a></div><div class="ttdeci">SPACE_RGX</div><div class="ttdoc">Regex for breaking text at whitespace.</div><div class="ttdef"><b>Definition:</b> <a href="common_8py_source.html#l00368">common.py:368</a></div></div>
<div class="ttc" id="aclassgrepros_1_1common_1_1_text_wrapper_html_a4951d21c8292a682f6d249ff375bdeb5"><div class="ttname"><a href="classgrepros_1_1common_1_1_text_wrapper.html#a4951d21c8292a682f6d249ff375bdeb5">grepros.common.TextWrapper.drop_whitespace</a></div><div class="ttdeci">drop_whitespace</div><div class="ttdef"><b>Definition:</b> <a href="common_8py_source.html#l00388">common.py:388</a></div></div>
<div class="ttc" id="aclassgrepros_1_1common_1_1_text_wrapper_html_a691096ca68413d152adb147808c9330f"><div class="ttname"><a href="classgrepros_1_1common_1_1_text_wrapper.html#a691096ca68413d152adb147808c9330f">grepros.common.TextWrapper.strlen</a></div><div class="ttdeci">def strlen(self, v)</div><div class="ttdoc">Returns length of string, using custom substring widths.</div><div class="ttdef"><b>Definition:</b> <a href="common_8py_source.html#l00431">common.py:431</a></div></div>
<div class="ttc" id="aclassgrepros_1_1common_1_1_progress_bar_html"><div class="ttname"><a href="classgrepros_1_1common_1_1_progress_bar.html">grepros.common.ProgressBar</a></div><div class="ttdoc">A simple ASCII progress bar with a ticker thread.</div><div class="ttdef"><b>Definition:</b> <a href="common_8py_source.html#l00251">common.py:251</a></div></div>
<div class="ttc" id="aclassgrepros_1_1common_1_1_console_printer_html_ae981ec329c0c9ac737283da55c865724"><div class="ttname"><a href="classgrepros_1_1common_1_1_console_printer.html#ae981ec329c0c9ac737283da55c865724">grepros.common.ConsolePrinter.error</a></div><div class="ttdeci">def error(cls, text=&quot;&quot;, *args, **kwargs)</div><div class="ttdoc">Prints error to stderr, formatted with args and kwargs, in error colors if supported.</div><div class="ttdef"><b>Definition:</b> <a href="common_8py_source.html#l00139">common.py:139</a></div></div>
<div class="ttc" id="aclassgrepros_1_1common_1_1_console_printer_html_a020554d0db454919368e7f18bee125f8"><div class="ttname"><a href="classgrepros_1_1common_1_1_console_printer.html#a020554d0db454919368e7f18bee125f8">grepros.common.ConsolePrinter.WARN_END</a></div><div class="ttdeci">WARN_END</div><div class="ttdef"><b>Definition:</b> <a href="common_8py_source.html#l00058">common.py:58</a></div></div>
<div class="ttc" id="anamespacegrepros_1_1common_html_a578d0c22b5ed496b2c6d787b5df848c6"><div class="ttname"><a href="namespacegrepros_1_1common.html#a578d0c22b5ed496b2c6d787b5df848c6">grepros.common.import_item</a></div><div class="ttdeci">def import_item(name)</div><div class="ttdoc">Returns imported module, or identifier from imported namespace; raises on error.</div><div class="ttdef"><b>Definition:</b> <a href="common_8py_source.html#l00676">common.py:676</a></div></div>
<div class="ttc" id="aclassgrepros_1_1common_1_1_text_wrapper_html_ad2a4bbf0c950ca89e157c4d235120a8e"><div class="ttname"><a href="classgrepros_1_1common_1_1_text_wrapper.html#ad2a4bbf0c950ca89e157c4d235120a8e">grepros.common.TextWrapper.lencache</a></div><div class="ttdeci">lencache</div><div class="ttdef"><b>Definition:</b> <a href="common_8py_source.html#l00392">common.py:392</a></div></div>
<div class="ttc" id="aclassgrepros_1_1common_1_1_console_printer_html_ada74a697af3acfc006ca23fedee36428"><div class="ttname"><a href="classgrepros_1_1common_1_1_console_printer.html#ada74a697af3acfc006ca23fedee36428">grepros.common.ConsolePrinter.print</a></div><div class="ttdeci">def print(cls, text=&quot;&quot;, *args, **kwargs)</div><div class="ttdoc">Prints text, formatted with args and kwargs.</div><div class="ttdef"><b>Definition:</b> <a href="common_8py_source.html#l00117">common.py:117</a></div></div>
<div class="ttc" id="aclassgrepros_1_1common_1_1_decompressor_html_adb5bece19722ba188d4b205a7de1cf24"><div class="ttname"><a href="classgrepros_1_1common_1_1_decompressor.html#adb5bece19722ba188d4b205a7de1cf24">grepros.common.Decompressor.decompress</a></div><div class="ttdeci">def decompress(cls, path, progress=False)</div><div class="ttdoc">Decompresses file to same directory, showing optional progress bar.</div><div class="ttdef"><b>Definition:</b> <a href="common_8py_source.html#l00190">common.py:190</a></div></div>
<div class="ttc" id="aclassgrepros_1_1common_1_1_text_wrapper_html_a6c35974db1e392b4e51332d47159681e"><div class="ttname"><a href="classgrepros_1_1common_1_1_text_wrapper.html#a6c35974db1e392b4e51332d47159681e">grepros.common.TextWrapper._wrap_chunks</a></div><div class="ttdeci">def _wrap_chunks(self, chunks)</div><div class="ttdoc">Returns a list of lines joined from text chunks, wrapped to width.</div><div class="ttdef"><b>Definition:</b> <a href="common_8py_source.html#l00446">common.py:446</a></div></div>
<div class="ttc" id="aclassgrepros_1_1common_1_1_text_wrapper_html_a146beaa715edc2d5a95859b066a631aa"><div class="ttname"><a href="classgrepros_1_1common_1_1_text_wrapper.html#a146beaa715edc2d5a95859b066a631aa">grepros.common.TextWrapper.customs</a></div><div class="ttdeci">customs</div><div class="ttdef"><b>Definition:</b> <a href="common_8py_source.html#l00393">common.py:393</a></div></div>
<div class="ttc" id="aclassgrepros_1_1common_1_1_console_printer_html_ae2ef5cf47c5bfd243e2e050721e25053"><div class="ttname"><a href="classgrepros_1_1common_1_1_console_printer.html#ae2ef5cf47c5bfd243e2e050721e25053">grepros.common.ConsolePrinter.flush</a></div><div class="ttdeci">def flush(cls)</div><div class="ttdoc">Ends current open line, if any.</div><div class="ttdef"><b>Definition:</b> <a href="common_8py_source.html#l00168">common.py:168</a></div></div>
<div class="ttc" id="anamespacegrepros_1_1common_html_ab43190b6708c9ed66ac4ef92f094bf58"><div class="ttname"><a href="namespacegrepros_1_1common.html#ab43190b6708c9ed66ac4ef92f094bf58">grepros.common.merge_dicts</a></div><div class="ttdeci">def merge_dicts(d1, d2)</div><div class="ttdoc">Merges d2 into d1, recursively for nested dicts.</div><div class="ttdef"><b>Definition:</b> <a href="common_8py_source.html#l00711">common.py:711</a></div></div>
<div class="ttc" id="anamespacegrepros_1_1common_html_aea9cbadf70cd7ea687a1d4b120529822"><div class="ttname"><a href="namespacegrepros_1_1common.html#aea9cbadf70cd7ea687a1d4b120529822">grepros.common.filter_fields</a></div><div class="ttdeci">def filter_fields(fieldmap, top=(), include=(), exclude=())</div><div class="ttdoc">Returns fieldmap filtered by include and exclude patterns.</div><div class="ttdef"><b>Definition:</b> <a href="common_8py_source.html#l00574">common.py:574</a></div></div>
<div class="ttc" id="aclassgrepros_1_1common_1_1_decompressor_html_ab10deb1b0b3424fa47b1dcb39809e9b6"><div class="ttname"><a href="classgrepros_1_1common_1_1_decompressor.html#ab10deb1b0b3424fa47b1dcb39809e9b6">grepros.common.Decompressor.make_decompressed_name</a></div><div class="ttdeci">def make_decompressed_name(cls, path)</div><div class="ttdoc">Returns the path without archive extension, if any.</div><div class="ttdef"><b>Definition:</b> <a href="common_8py_source.html#l00231">common.py:231</a></div></div>
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="dir_0d8d2c83378af3dbf8497b689631bb64.html">grepros</a></li><li class="navelem"><a class="el" href="common_8py.html">common.py</a></li>
    <li class="footer">Generated on Thu Mar 30 2023 20:01:15 for grepros by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
